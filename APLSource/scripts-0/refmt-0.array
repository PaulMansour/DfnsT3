'⍝ Reformat dfn/op:⍞000D⍞000D      2 refmt ⎕cr''refmt''⍞000Drefmt←{⎕IO ⎕ML←0 1             ⍝ Reformat dfn/op.                 ⍞000D  ⍺←4 ⋄ dent csep←⍺            ⍝ default indents and ⍝-separation.⍞000D  unqt←{~≠\⍵=''''''''}             ⍝ mask of unquoted tokens.         ⍞000D  code coms←↓⍉↑{               ⍝ code and comment vectors.        ⍞000D    umsk←unqt ⍵                ⍝ unquoted chars.                  ⍞000D    cmsk←∨\umsk∧⍵=''⍝''          ⍝ comment mask.                    ⍞000D    code coms←(0 1=⊂cmsk)/¨⊂⍵  ⍝ code / comments.                 ⍞000D    rlb←{(∨\'' ''≠⍵)/⍵}          ⍝ remove leading blanks.           ⍞000D    clean←⌽rlb⌽rlb code        ⍝ cleaned code.                    ⍞000D    clean coms                 ⍝ clean code / comment.            ⍞000D  }¨↓↑⍵                        ⍝ for each line.                   ⍞000D  dents←{                      ⍝ indentation for each line        ⍞000D    toks←(unqt ⍵){⍺\⍺/⍵}⍵      ⍝ unquoted code characters.        ⍞000D    dvec←-⌿0 1⌽+\''{}''∘.=toks   ⍝ brace-depth of each token.       ⍞000D    lmask←toks=''·''             ⍝ start of each line.              ⍞000D    (dent×lmask/dvec)/¨'' ''     ⍝ indentation for each line.       ⍞000D  }↑,/''·'',¨code                ⍝ collected code vector.           ⍞000D  scoms←(⊂csep⍴'' ''),¨coms      ⍝ separated comments.              ⍞000D  icode←↓↑dents,¨code          ⍝ indented code lines.             ⍞000D  rtb←⌽∘{(∨\⍵≠'' '')/⍵}∘⌽        ⍝ remove trailing blanks.          ⍞000D  qnr←icode,∘rtb¨scoms         ⍝ reunited code and comments.      ⍞000D  1=≡⍵:↑qnr ⋄ qnr              ⍝ ⎕cr or ⎕nr.                      ⍞000D}                                                                 ⍞000D⍞000D      1 2 refmt ⎕cr''refmt''⍞000Drefmt←{⎕IO ⎕ML←0 1           ⍝ Reformat dfn/op.                 ⍞000D ⍺←4 ⋄ dent csep←⍺           ⍝ default indents and ⍝-separation.⍞000D unqt←{~≠\⍵=''''''''}            ⍝ mask of unquoted tokens.         ⍞000D code coms←↓⍉↑{              ⍝ code and comment vectors.        ⍞000D  umsk←unqt ⍵                ⍝ unquoted chars.                  ⍞000D  cmsk←∨\umsk∧⍵=''⍝''          ⍝ comment mask.                    ⍞000D  code coms←(0 1=⊂cmsk)/¨⊂⍵  ⍝ code / comments.                 ⍞000D  rlb←{(∨\'' ''≠⍵)/⍵}          ⍝ remove leading blanks.           ⍞000D  clean←⌽rlb⌽rlb code        ⍝ cleaned code.                    ⍞000D  clean coms                 ⍝ clean code / comment.            ⍞000D }¨↓↑⍵                       ⍝ for each line.                   ⍞000D dents←{                     ⍝ indentation for each line        ⍞000D  toks←(unqt ⍵){⍺\⍺/⍵}⍵      ⍝ unquoted code characters.        ⍞000D  dvec←-⌿0 1⌽+\''{}''∘.=toks   ⍝ brace-depth of each token.       ⍞000D  lmask←toks=''·''             ⍝ start of each line.              ⍞000D  (dent×lmask/dvec)/¨'' ''     ⍝ indentation for each line.       ⍞000D }↑,/''·'',¨code               ⍝ collected code vector.           ⍞000D scoms←(⊂csep⍴'' ''),¨coms     ⍝ separated comments.              ⍞000D icode←↓↑dents,¨code         ⍝ indented code lines.             ⍞000D rtb←⌽∘{(∨\⍵≠'' '')/⍵}∘⌽       ⍝ remove trailing blanks.          ⍞000D qnr←icode,∘rtb¨scoms        ⍝ reunited code and comments.      ⍞000D 1=≡⍵:↑qnr ⋄ qnr             ⍝ ⎕cr or ⎕nr.                      ⍞000D}                                                               ⍞000D' 
