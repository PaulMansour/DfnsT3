'⍝ Rational number near real ⍵:⍞000D⍞000D    rational 0.75               ⍝ three quarters.⍞000D3 4⍞000D    rational ÷3                 ⍝ one third.⍞000D1 3⍞000D    rational 9÷16               ⍝ pair of ..⍞000D9 16⍞000D    gcd/rational 9÷16           ⍝ .. relatively prime numbers:⍞000D1⍞000D    rational 11÷29              ⍝ pair matches rational of quotient ...⍞000D11 29⍞000D                                ⍝ ... for all relatively prime pairs:⍞000D⍞000D    {⍵≡rational÷/⍵}¨ ∘.,⍨ sieve 2 to 100⍞000D0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1⍞000D1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0⍞000D⍞000D    numbs ← +/¨1⊂ 2 2 2⍴ +\10*-⍳8       ⍝ nested numeric array.⍞000D    disp numbs⍞000D┌─────────────────┬───────────────────┐⍞000D│0.1     0.111    │0.11     0.1111    │⍞000D│0.11111 0.1111111│0.111111 0.11111111│⍞000D└─────────────────┴───────────────────┘⍞000D⍞000D    disp rational numbs                 ⍝ rational pairs.⍞000D┌───────────────┬─────────────────┐⍞000D│    1     111  │    11     1111  │⍞000D│11111 1111111  │111111 11111111  │⍞000D├───────────────┼─────────────────┤⍞000D│    10     1000│    100     10000│⍞000D│100000 10000000│1000000 100000000│⍞000D└───────────────┴─────────────────┘⍞000D⍞000D    numbs ≡ ÷⌿ rational numbs           ⍝ round-trip.⍞000D1⍞000D⍞000D    {{⍵÷∨/⍵}⍵,1} 5÷7            ⍝ using gcd.⍞000D5 7⍞000D⍞000D    ones ← +\ 10*¯1 to ¯8       ⍝ Gianluigi''s examples.⍞000D    ones⍞000D0.1 0.11 0.111 0.1111 0.11111 0.111111 0.1111111 0.11111111⍞000D⍞000D    ⍉ rational ones⍞000D       1        10⍞000D      11       100⍞000D     111      1000⍞000D    1111     10000⍞000D   11111    100000⍞000D  111111   1000000⍞000D 1111111  10000000⍞000D11111111 100000000⍞000D⍞000D    ⍉ rational ones×9⍞000D       9       10⍞000D      99      100⍞000D     999     1000⍞000D    9999    10000⍞000D   99999   100000⍞000D  999999  1000000⍞000D 9999999 10000000⍞000D99999998 99999999⍞000D⍞000D    ,⌿ rational ÷/¨ ⍳10 10⍞000D 1 1   1 2  1 3   1 4  1 5  1 6  1 7   1 8  1 9   1 10 ⍞000D 2 1   1 1  2 3   1 2  2 5  1 3  2 7   1 4  2 9   1 5  ⍞000D 3 1   3 2  1 1   3 4  3 5  1 2  3 7   3 8  1 3   3 10 ⍞000D 4 1   2 1  4 3   1 1  4 5  2 3  4 7   1 2  4 9   2 5  ⍞000D 5 1   5 2  5 3   5 4  1 1  5 6  5 7   5 8  5 9   1 2  ⍞000D 6 1   3 1  2 1   3 2  6 5  1 1  6 7   3 4  2 3   3 5  ⍞000D 7 1   7 2  7 3   7 4  7 5  7 6  1 1   7 8  7 9   7 10 ⍞000D 8 1   4 1  8 3   2 1  8 5  4 3  8 7   1 1  8 9   4 5  ⍞000D 9 1   9 2  3 1   9 4  9 5  3 2  9 7   9 8  1 1   9 10 ⍞000D 10 1  5 1  10 3  5 2  2 1  5 3  10 7  5 4  10 9  1 1  ⍞000D⍞000D⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝ The following example gave JMS a bit of a fright:⍞000D⍞000D    P←×/71 73 79 83                     ⍝ product of distinct primes.⍞000D    Q←×/89 97 101 103                   ⍝ product of distinct, distinct primes.⍞000D⍞000D    P Q ≡ rational P÷Q                  ⍝ why doesn''t this match?⍞000D0⍞000D    ⍝ The problem is that the function finds a simpler rational number ⍞000D    ⍝ within comparison tolerance of the IEEE representation of P÷Q:⍞000D⍞000D    P,Q                                 ⍝ relatively prime numbers.⍞000D33984931 89809099⍞000D⍞000D    disp factors¨P Q                    ⍝ check factors of P and Q.⍞000D┌───────────┬─────────────┐⍞000D│71 73 79 83│89 97 101 103│⍞000D└───────────┴─────────────┘⍞000D⍞000D    rational P÷Q                        ⍝ simpler tolerably-equal rational.⍞000D7042375 18610288⍞000D⍞000D    disp factors¨ rational P÷Q          ⍝ factors of simpler rational,⍞000D┌─────────────┬───────────────┐⍞000D│5 5 5 53 1063│2 2 2 2 1163143│⍞000D└─────────────┴───────────────┘⍞000D⍞000D    (P÷Q)=÷/rational P÷Q                ⍝   which is tolerably equal to P÷Q.⍞000D1⍞000D    ⍝ If we restrict tolerance slightly, P,Q is again our best bet:⍞000D⍞000D    P Q ≡ 1e¯15 rational P÷Q            ⍝ now it matches, phew!⍞000D1⍞000D⍞000D⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍞000D⍞000D⍝ ⎕ct-intolerant version:⍞000D⍞000D    ratf←{⎕IO ⎕ML ⎕CT←0                 ⍝ Exact rational from IEEE double.⍞000D        digs←16↑⎕D,⎕A                   ⍝ hex digits.⍞000D        bits←,⍉2 2 2 2⊤digs⍳hexf ⍵      ⍝ binary floating number.⍞000D        split←(⍳⍴bits)∊0 1 12           ⍝ split fields: sign exponent mantissa.⍞000D        bsign bexp bmant←split⊂bits     ⍝ bit-vector fields.⍞000D        sign←bsign/''¯''                  ⍝ neg sign⍞000D        exp←¯1022+2⊥bexp                ⍝ signed numeric binary exponent.⍞000D        deco←{↑⍺{⍺+nats ⍺⍺×nats ⍵}/⌽⍵}  ⍝ accurate ⍺-decode.⍞000D        top←2 deco 1,bmant              ⍝ numerator.⍞000D        bot←2*nats 53-exp               ⍝ denominator.⍞000D        sign '''',¨top{                   ⍝ rational pair, char vectors à la nats.⍞000D            1∊''13579''∊,↑¯1↑¨⍺ ⍵:⍺ ⍵     ⍝ either number is odd: done.⍞000D            (⍺÷nats 2)∇ ⍵÷nats 2        ⍝ both even: cancel 2s.⍞000D        }bot⍞000D    }⍞000D⍞000D    disp ratf 1234⍞000D┌────┬─┐⍞000D│1234│1│⍞000D└────┴─┘⍞000D    disp ratf 0.1⍞000D┌────────────────┬─────────────────┐⍞000D│3602879701896397│36028797018963968│⍞000D└────────────────┴─────────────────┘⍞000D    disp ratf 2*¯16⍞000D┌─┬─────┐⍞000D│1│65536│⍞000D└─┴─────┘⍞000D    disp ratf ¯0.75⍞000D┌──┬─┐⍞000D│¯3│4│⍞000D└──┴─┘⍞000D' 
