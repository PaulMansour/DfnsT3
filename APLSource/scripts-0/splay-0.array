'⍝ Splay tree:⍞000D⍞000D    put ← ∪ splay           ⍝ :: tree ← tree ∇ key val⍞000D    get ← ⍎ splay           ⍝ :: val tree ← key ∇ tree⍞000D    rem ← ~ splay           ⍝ :: tree ← tree ∇ key⍞000D    fmt ← ⍕ splay           ⍝ :: cmat ← ∇ tree⍞000D    chk ← ? splay           ⍝ :: ok height size ← ∇ tree⍞000D    vec ← ∊ splay           ⍝ :: (key val)[] ← ∇ tree⍞000D    dep ← ≡ splay           ⍝ :: depth ← key ∇ tree⍞000D⍞000D    tree←0∘(put foldl)      ⍝ tree from vector of keys.⍞000D⍞000D    pairs ← (''one''1) (''two''2) (''three''3) (''four''4) (''five''5) (''six''6) (''seven''7)⍞000D⍞000D    fmt tree pairs⍞000D            ┌five=5              ⍞000D     ┌four=4┘                    ⍞000Done=1┤                           ⍞000D     │                   ┌seven=7⍞000D     │             ┌six=6┘       ⍞000D     │     ┌three=3┘             ⍞000D     └two=2┘                     ⍞000D⍞000D    pairs[⍋↑⊃¨pairs] ≡ vec tree pairs           ⍝ check enlist of tree.⍞000D1⍞000D⍞000D    fmt tree 4 2 1 3 6 5 7                      ⍝ balanced inserts.⍞000D       ┌1=1⍞000D   ┌2=2┤   ⍞000D   │   └3=3⍞000D4=4┤       ⍞000D   │   ┌5=5⍞000D   └6=6┤   ⍞000D       └7=7⍞000D⍞000D    fmt tree ⍳10                                ⍝ linear inserts.⍞000D1=1┐                                     ⍞000D   └2=2┐                                 ⍞000D       └3=3┐                             ⍞000D           └4=4┐                         ⍞000D               └5=5┐                     ⍞000D                   └6=6┐                 ⍞000D                       └7=7┐             ⍞000D                           └8=8┐         ⍞000D                               └9=9┐     ⍞000D                                   └10=10⍞000D⍞000D    ⍝ This function creates a splay tree from the vector right arg and then⍞000D    ⍝ successively accesses its left arg value until the tree stabilises:⍞000D⍞000D    try←{disp ↑fmt\¨↑∘(get/)traj ⍺,⊂tree ⍵}     ⍝ see →traj←⍞000D⍞000D    10 try ⍳10                                  ⍝ successive accesses of key=10.⍞000D┌──┬─────────────────────────────────────────┐⍞000D│10│1=1┐                                     │⍞000D│  │   └2=2┐                                 │⍞000D│  │       └3=3┐                             │⍞000D│  │           └4=4┐                         │⍞000D│  │               └5=5┐                     │⍞000D│  │                   └6=6┐                 │⍞000D│  │                       └7=7┐             │⍞000D│  │                           └8=8┐         │⍞000D│  │                               └9=9┐     │⍞000D│  │                                   └10=10│⍞000D├──┼─────────────────────────────────────────┤⍞000D│10│1=1┐                                     │⍞000D│  │   └2=2┐                                 │⍞000D│  │       └3=3┐                             │⍞000D│  │           └4=4┐                         │⍞000D│  │               └5=5┐                     │⍞000D│  │                   └6=6┐                 │⍞000D│  │                       └7=7┐             │⍞000D│  │                           │         ┌8=8│⍞000D│  │                           │     ┌9=9┘   │⍞000D│  │                           └10=10┘       │⍞000D├──┼─────────────────────────────────────────┤⍞000D│10│1=1┐                                     │⍞000D│  │   └2=2┐                                 │⍞000D│  │       └3=3┐                             │⍞000D│  │           └4=4┐                         │⍞000D│  │               └5=5┐                     │⍞000D│  │                   │         ┌6=6        │⍞000D│  │                   │     ┌7=7┤           │⍞000D│  │                   │     │   │   ┌8=8    │⍞000D│  │                   │     │   └9=9┘       │⍞000D│  │                   └10=10┘               │⍞000D├──┼─────────────────────────────────────────┤⍞000D│10│1=1┐                                     │⍞000D│  │   └2=2┐                                 │⍞000D│  │       └3=3┐                             │⍞000D│  │           │         ┌4=4                │⍞000D│  │           │     ┌5=5┤                   │⍞000D│  │           │     │   │   ┌6=6            │⍞000D│  │           │     │   └7=7┤               │⍞000D│  │           │     │       │   ┌8=8        │⍞000D│  │           │     │       └9=9┘           │⍞000D│  │           └10=10┘                       │⍞000D├──┼─────────────────────────────────────────┤⍞000D│10│1=1┐                                     │⍞000D│  │   │         ┌2=2                        │⍞000D│  │   │     ┌3=3┤                           │⍞000D│  │   │     │   │   ┌4=4                    │⍞000D│  │   │     │   └5=5┤                       │⍞000D│  │   │     │       │   ┌6=6                │⍞000D│  │   │     │       └7=7┤                   │⍞000D│  │   │     │           │   ┌8=8            │⍞000D│  │   │     │           └9=9┘               │⍞000D│  │   └10=10┘                               │⍞000D├──┼─────────────────────────────────────────┤⍞000D│10│     ┌1=1┐                               │⍞000D│  │     │   │   ┌2=2                        │⍞000D│  │     │   └3=3┤                           │⍞000D│  │     │       │   ┌4=4                    │⍞000D│  │     │       └5=5┤                       │⍞000D│  │     │           │   ┌6=6                │⍞000D│  │     │           └7=7┤                   │⍞000D│  │     │               │   ┌8=8            │⍞000D│  │     │               └9=9┘               │⍞000D│  │10=10┘                                   │⍞000D└──┴─────────────────────────────────────────┘⍞000D⍞000D    1 try ⌽⍳10                                  ⍝ successive accesses of key=1.⍞000D┌─┬─────────────────────────────────────────┐⍞000D│1│                                     ┌1=1│⍞000D│ │                                 ┌2=2┘   │⍞000D│ │                             ┌3=3┘       │⍞000D│ │                         ┌4=4┘           │⍞000D│ │                     ┌5=5┘               │⍞000D│ │                 ┌6=6┘                   │⍞000D│ │             ┌7=7┘                       │⍞000D│ │         ┌8=8┘                           │⍞000D│ │     ┌9=9┘                               │⍞000D│ │10=10┘                                   │⍞000D├─┼─────────────────────────────────────────┤⍞000D│1│                             ┌1=1┐       │⍞000D│ │                             │   └2=2┐   │⍞000D│ │                             │       └3=3│⍞000D│ │                         ┌4=4┘           │⍞000D│ │                     ┌5=5┘               │⍞000D│ │                 ┌6=6┘                   │⍞000D│ │             ┌7=7┘                       │⍞000D│ │         ┌8=8┘                           │⍞000D│ │     ┌9=9┘                               │⍞000D│ │10=10┘                                   │⍞000D├─┼─────────────────────────────────────────┤⍞000D│1│                     ┌1=1┐               │⍞000D│ │                     │   │   ┌2=2┐       │⍞000D│ │                     │   │   │   └3=3    │⍞000D│ │                     │   └4=4┤           │⍞000D│ │                     │       └5=5        │⍞000D│ │                 ┌6=6┘                   │⍞000D│ │             ┌7=7┘                       │⍞000D│ │         ┌8=8┘                           │⍞000D│ │     ┌9=9┘                               │⍞000D│ │10=10┘                                   │⍞000D├─┼─────────────────────────────────────────┤⍞000D│1│             ┌1=1┐                       │⍞000D│ │             │   │       ┌2=2┐           │⍞000D│ │             │   │       │   └3=3        │⍞000D│ │             │   │   ┌4=4┤               │⍞000D│ │             │   │   │   └5=5            │⍞000D│ │             │   └6=6┤                   │⍞000D│ │             │       └7=7                │⍞000D│ │         ┌8=8┘                           │⍞000D│ │     ┌9=9┘                               │⍞000D│ │10=10┘                                   │⍞000D├─┼─────────────────────────────────────────┤⍞000D│1│     ┌1=1┐                               │⍞000D│ │     │   │           ┌2=2┐               │⍞000D│ │     │   │           │   └3=3            │⍞000D│ │     │   │       ┌4=4┤                   │⍞000D│ │     │   │       │   └5=5                │⍞000D│ │     │   │   ┌6=6┤                       │⍞000D│ │     │   │   │   └7=7                    │⍞000D│ │     │   └8=8┤                           │⍞000D│ │     │       └9=9                        │⍞000D│ │10=10┘                                   │⍞000D├─┼─────────────────────────────────────────┤⍞000D│1│1=1┐                                     │⍞000D│ │   │                 ┌2=2┐               │⍞000D│ │   │                 │   └3=3            │⍞000D│ │   │             ┌4=4┤                   │⍞000D│ │   │             │   └5=5                │⍞000D│ │   │         ┌6=6┤                       │⍞000D│ │   │         │   └7=7                    │⍞000D│ │   │     ┌8=8┤                           │⍞000D│ │   │     │   └9=9                        │⍞000D│ │   └10=10┘                               │⍞000D└─┴─────────────────────────────────────────┘⍞000D⍞000D      1 try 3 2 1                   ⍝ test double rotation.⍞000D┌─┬───────────┐⍞000D│1│       ┌1=1│⍞000D│ │   ┌2=2┘   │⍞000D│ │3=3┘       │⍞000D├─┼───────────┤⍞000D│1│1=1┐       │⍞000D│ │   └2=2┐   │⍞000D│ │       └3=3│⍞000D└─┴───────────┘⍞000D⍞000D    3 try 4 2 3                     ⍝ test double counter-rotation.⍞000D┌─┬───────────┐⍞000D│3│   ┌2=2┐   │⍞000D│ │   │   └3=3│⍞000D│ │4=4┘       │⍞000D├─┼───────────┤⍞000D│3│   ┌2=2    │⍞000D│ │3=3┤       │⍞000D│ │   └4=4    │⍞000D└─┴───────────┘⍞000D⍞000D    chk tree⍳7                      ⍝ tree stats: ok size mean_depth height⍞000D1 7 3 7⍞000D⍞000D    ⎕rl←7*5                         ⍝ random seed.⍞000D⍞000D    tt ← tree 256?256               ⍝ random 256-node tree.⍞000D⍞000D    chk tt                          ⍝ ... has reasonable height (17).⍞000D1 256 8 17⍞000D⍞000D    revt←{⊃⌽⍵ get ⍺}                ⍝ revised tree, ignoring retrieved value.⍞000D⍞000D    tt ← tt revt foldl 256?256      ⍝ search once for each key.⍞000D⍞000D    chk tt                          ⍝ ... increases (worsens) tree height (46).⍞000D1 256 23 46⍞000D⍞000D    keys←16?256                     ⍝ random selection of keys.⍞000D⍞000D    keys dep¨⊂tt                    ⍝ depth of keys.⍞000D38 17 8 35 31 24 9 28 31 22 3 14 19 31 29 37⍞000D⍞000D    tt ← tt revt foldl 16/keys      ⍝ repeated searches for a subset of keys.⍞000D⍞000D    keys dep¨⊂tt                    ⍝ ... reduces key depths.⍞000D7 4 6 6 5 6 5 4 4 3 4 2 3 3 2 1⍞000D⍞000D    chk tt                          ⍝ ... reduces (improves) tree height (23).⍞000D1 256 9 23⍞000D⍞000D    tt ← tt rem foldl 256?256       ⍝ remove all nodes in random order.⍞000D⍞000D    tt                              ⍝ check all nodes removed.⍞000D0⍞000D    Alpha test ''_BST''               ⍝ common BST tests.⍞000D1' 
