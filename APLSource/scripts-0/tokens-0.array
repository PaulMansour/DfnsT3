'⍝ Lex of APL src line:⍞000D⍞000D    1 disp 1 tokens ''1 2 3+4 5 6''       ⍝ numeric vectors as single token.⍞000D┌→────┬─┬─────┐⍞000D│1 2 3│+│4 5 6│⍞000D└────→┴→┴────→┘⍞000D    1 disp 0 tokens ''1 2 3+4 5 6''       ⍝ numeric vectors as multiple tokens.⍞000D┌→┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐⍞000D│1│ │2│ │3│+│4│ │5│ │6│⍞000D└→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┘⍞000D⍞000D    ⍪1 disp∘tokens¨⎕NR''tokens''⍞000D ┌→─────┬─┬─┬───┬─┬─┬───────────────────────────┬──────────────────────┐                   ⍞000D │tokens│←│{│⎕ML│←│1│                           │⍝ Lex of APL src line.│                   ⍞000D └─────→┴→┴→┴──→┴→┴→┴──────────────────────────→┴─────────────────────→┘                   ⍞000D ┌→───┬─┬─┬─┬─┬─┬─┬──┬─┬─┬──────────────────────────┬──────────────────────────────────┐   ⍞000D │    │⍺│←│0│ │⋄│ │nv│←│⍺│                          │⍝ numeric vectors as single token.│   ⍞000D └───→┴→┴→┴→┴→┴→┴→┴─→┴→┴→┴─────────────────────────→┴─────────────────────────────────→┘   ⍞000D ┌→───┬────┬─┬─┬─┬─┬─┬───┬─┬─┬─┬─┬─┬─┬───┬─┬─────┬─────────┬─────────────────────┐         ⍞000D │    │alph│←│{│(│0│≤│⎕NC│⍪│⍵│)│/│⍵│}│⎕AV│~│''⍺⍵∇''│         │⍝ alphabet for names.│         ⍞000D └───→┴───→┴→┴→┴→┴→┴→┴──→┴→┴→┴→┴→┴→┴→┴──→┴→┴────→┴────────→┴────────────────────→┘         ⍞000D ┌→───┬───┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬───────────────────────┬─────────────────────┐              ⍞000D │    │all│←│{│+│/│∧│\│⍺│∊│⍵│}│                       │⍝ No. of leading ⍺∊⍵.│              ⍞000D └───→┴──→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴──────────────────────→┴────────────────────→┘              ⍞000D ┌→───┬───┬─┬─┬─┬─┬─┬─┬─┬─┬─┬───┬─┬─┬─┬─┬─┬────────────────┬─────────────────────┐         ⍞000D │    │acc│←│{│(│⍺│,│↑│/│⍵│)│lex│⊃│↓│/│⍵│}│                │⍝ accumulated tokens.│         ⍞000D └───→┴──→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴──→┴→┴→┴→┴→┴→┴───────────────→┴────────────────────→┘         ⍞000D ┌→───┬───┬─┬─┐                                                                            ⍞000D │    │lex│←│{│                                                                            ⍞000D └───→┴──→┴→┴→┘                                                                            ⍞000D ┌→───────┬─┬─┬─┬─┬─┬─┬─┬─┬─┬──┬─┬─┬─┬──────────────────┬──────────────────────────┐       ⍞000D │        │0│=│⍴│⍵│:│⍺│ │⋄│ │hd│←│⊃│⍵│                  │⍝ Next char else finished.│       ⍞000D └───────→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴─→┴→┴→┴→┴─────────────────→┴─────────────────────────→┘       ⍞000D ┌→───────┬──┬─┬───┬─┬─┬─┬───────────────────────┬──────────────┐                          ⍞000D │        │hd│=│'' ''│:│⍺│{│                       │⍝ White Space.│                          ⍞000D └───────→┴─→┴→┴──→┴→┴→┴→┴──────────────────────→┴─────────────→┘                          ⍞000D ┌→───────────┬────┬─┬─┬─┬───┬───┐                                                         ⍞000D │            │size│←│⍵│ │all│'' ''│                                                         ⍞000D └───────────→┴───→┴→┴→┴→┴──→┴──→┘                                                         ⍞000D ┌→───────────┬─┬─┬───┬─┬────┬─┬─┐                                                         ⍞000D │            │⍺│ │acc│ │size│ │⍵│                                                         ⍞000D └───────────→┴→┴→┴──→┴→┴───→┴→┴→┘                                                         ⍞000D ┌→───────┬─┬─┐                                                                            ⍞000D │        │}│⍵│                                                                            ⍞000D └───────→┴→┴→┘                                                                            ⍞000D ┌→───────┬──┬─┬────┬─┬─┬─┬──────────────────────┬──────┐                                  ⍞000D │        │hd│∊│alph│:│⍺│{│                      │⍝ Name│                                  ⍞000D └───────→┴─→┴→┴───→┴→┴→┴→┴─────────────────────→┴─────→┘                                  ⍞000D ┌→───────────┬────┬─┬─┬─┬───┬─┬────┬─┬──┐                                                 ⍞000D │            │size│←│⍵│ │all│ │alph│,│⎕D│                                                 ⍞000D └───────────→┴───→┴→┴→┴→┴──→┴→┴───→┴→┴─→┘                                                 ⍞000D ┌→───────────┬─┬─┬───┬─┬────┬─┬─┐                                                         ⍞000D │            │⍺│ │acc│ │size│ │⍵│                                                         ⍞000D └───────────→┴→┴→┴──→┴→┴───→┴→┴→┘                                                         ⍞000D ┌→───────┬─┬─┐                                                                            ⍞000D │        │}│⍵│                                                                            ⍞000D └───────→┴→┴→┘                                                                            ⍞000D ┌→───────┬──┬─┬───┬─┬─┬─┬───────────────────────┬─────────────┐                           ⍞000D │        │hd│∊│''⎕''│:│⍺│{│                       │⍝ System Name│                           ⍞000D └───────→┴─→┴→┴──→┴→┴→┴→┴──────────────────────→┴────────────→┘                           ⍞000D ┌→───────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬───┬─┬────┐                                            ⍞000D │            │size│←│1│+│(│1│↓│⍵│)│all│ │alph│                                            ⍞000D └───────────→┴───→┴→┴→┴→┴→┴→┴→┴→┴→┴──→┴→┴───→┘                                            ⍞000D ┌→───────────┬─┬─┬───┬─┬────┬─┬─┐                                                         ⍞000D │            │⍺│ │acc│ │size│ │⍵│                                                         ⍞000D └───────────→┴→┴→┴──→┴→┴───→┴→┴→┘                                                         ⍞000D ┌→───────┬─┬─┐                                                                            ⍞000D │        │}│⍵│                                                                            ⍞000D └───────→┴→┴→┘                                                                            ⍞000D ┌→───────┬──┬─┬────┬─┬─┬─┬──────────────────────┬──────────────┐                          ⍞000D │        │hd│=│''''''''│:│⍺│{│                      │⍝ Char literal│                          ⍞000D └───────→┴─→┴→┴───→┴→┴→┴→┴─────────────────────→┴─────────────→┘                          ⍞000D ┌→───────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬──┬─┬─┬─┬─┬─┬──┬─┬─┐                                   ⍞000D │            │size│←│+│/│∧│\│{│⍵│∨│¯1│⌽│⍵│}│≠│\│hd│=│⍵│                                   ⍞000D └───────────→┴───→┴→┴→┴→┴→┴→┴→┴→┴→┴─→┴→┴→┴→┴→┴→┴─→┴→┴→┘                                   ⍞000D ┌→───────────┬─┬─┬───┬─┬────┬─┬─┐                                                         ⍞000D │            │⍺│ │acc│ │size│ │⍵│                                                         ⍞000D └───────────→┴→┴→┴──→┴→┴───→┴→┴→┘                                                         ⍞000D ┌→───────┬─┬─┐                                                                            ⍞000D │        │}│⍵│                                                                            ⍞000D └───────→┴→┴→┘                                                                            ⍞000D ┌→───────┬──┬─┬──┬─┬───┬─┬─┬─┬────────────────────┬─────────────────┐                     ⍞000D │        │hd│∊│⎕D│,│''¯''│:│⍺│{│                    │⍝ Numeric literal│                     ⍞000D └───────→┴─→┴→┴─→┴→┴──→┴→┴→┴→┴───────────────────→┴────────────────→┘                     ⍞000D ┌→───────────┬───┬─┬─┬─┬───┬─┬──┬─┬──────┬─┬──┬─┬───┬──┬───────────────────────────────┐  ⍞000D │            │max│←│⍵│ │all│ │⎕D│,│''.¯EJ''│,│nv│/│'' ''│  │⍝ numbers with trailing blanks.│  ⍞000D └───────────→┴──→┴→┴→┴→┴──→┴→┴─→┴→┴─────→┴→┴─→┴→┴──→┴─→┴──────────────────────────────→┘  ⍞000D ┌→───────────┬────┬─┬───┬─┬─┬─┬─┬─┬───┬─┬─┬───┬─┬─┬─────┬───────────────────────────────┐ ⍞000D │            │size│←│max│-│+│/│∧│\│'' ''│=│⌽│max│↑│⍵│     │⍝  ..  without trailing blanks.│ ⍞000D └───────────→┴───→┴→┴──→┴→┴→┴→┴→┴→┴──→┴→┴→┴──→┴→┴→┴────→┴──────────────────────────────→┘ ⍞000D ┌→───────────┬─┬─┬───┬─┬────┬─┬─┐                                                         ⍞000D │            │⍺│ │acc│ │size│ │⍵│                                                         ⍞000D └───────────→┴→┴→┴──→┴→┴───→┴→┴→┘                                                         ⍞000D ┌→───────┬─┬─┐                                                                            ⍞000D │        │}│⍵│                                                                            ⍞000D └───────→┴→┴→┘                                                                            ⍞000D ┌→───────┬──┬─┬──────┬─┬─┬─┬────────────────────┬──────────────────────┐                  ⍞000D │        │hd│∊│''⍺⍵∇:''│:│⍺│{│                    │⍝ ⍺⍺ or ⍵⍵ or ∇∇ or ::│                  ⍞000D └───────→┴─→┴→┴─────→┴→┴→┴→┴───────────────────→┴─────────────────────→┘                  ⍞000D ┌→───────────┬────┬─┬─┬─┬───┬─┬──┐                                                        ⍞000D │            │size│←│⍵│ │all│ │hd│                                                        ⍞000D └───────────→┴───→┴→┴→┴→┴──→┴→┴─→┘                                                        ⍞000D ┌→───────────┬─┬─┬───┬─┬────┬─┬─┐                                                         ⍞000D │            │⍺│ │acc│ │size│ │⍵│                                                         ⍞000D └───────────→┴→┴→┴──→┴→┴───→┴→┴→┘                                                         ⍞000D ┌→───────┬─┬─┐                                                                            ⍞000D │        │}│⍵│                                                                            ⍞000D └───────→┴→┴→┘                                                                            ⍞000D ┌→───────┬──┬─┬───┬─┬─┬─┬───┬─┬─┬─┬─┬─┬───────────────┬─────────┐                         ⍞000D │        │hd│=│''⍝''│:│⍺│ │acc│(│⍴│⍵│)│⍵│               │⍝ Comment│                         ⍞000D └───────→┴─→┴→┴──→┴→┴→┴→┴──→┴→┴→┴→┴→┴→┴──────────────→┴────────→┘                         ⍞000D ┌→───────┬─┬─┬───┬─┬─┬─┬─┬───────────────────────┬────────────────────┐                   ⍞000D │        │⍺│ │acc│ │1│ │⍵│                       │⍝ Single char token.│                   ⍞000D └───────→┴→┴→┴──→┴→┴→┴→┴→┴──────────────────────→┴───────────────────→┘                   ⍞000D ┌→───┬─┐                                                                                  ⍞000D │    │}│                                                                                  ⍞000D └───→┴→┘                                                                                  ⍞000D ┌→───┬─┬─┬─┬─┬──┬─┬───┬─┬─┐                                                               ⍞000D │    │(│0│⍴│⊂│''''│)│lex│,│⍵│                                                               ⍞000D └───→┴→┴→┴→┴→┴─→┴→┴──→┴→┴→┘                                                               ⍞000D ┌→┐                                                                                       ⍞000D │}│                                                                                       ⍞000D └→┘                                                                                       ⍞000D⍞000D    ⍝ Alternative coding:⍞000D⍞000D    tokens2←{⎕ML←0                              ⍝ Lex of APL source line.⍞000D        ⍺←0 ⋄ nv←⍺/'' ''                          ⍝ numeric vector as single tokn.⍞000D        alph←⎕A,⎕Á,''_∆⍙'',26↑17↓⎕AV              ⍝ Alphabet for names⍞000D        all←{+/∧\⍺∊⍵}                           ⍝ ∇ No of leading ⍺∊⍵⍞000D        acc←{n←⍺⍺ ⍵ ⋄ (⍺,⊂n↑⍵)lex n↓⍵}          ⍝ ∇∇ Accumulated tokens⍞000D        lex←{                                   ⍝ ∇ Next lexical token⍞000D            0=⍴⍵:⍺ ⋄ hd←⊃⍵                      ⍝ Next char else finished⍞000D            hd='' '':⍺{⍵ all'' ''}acc ⍵             ⍝ White Space⍞000D            hd∊alph:⍺{⍵ all alph,⎕D}acc ⍵       ⍝ Name⍞000D            hd∊''⎕:'':⍺{1+(1↓⍵)all alph,'':''}acc ⍵ ⍝ System Name / Keyword / guard⍞000D            hd='''''''':⍺{+/∧\{⍵∨¯1⌽⍵}≠\⍵=hd}acc ⍵  ⍝ Char literal⍞000D            hd∊⎕D,''¯'':⍺{⍵ all ⎕D,''.¯E'',nv}acc ⍵ ⍝ Numeric scalar literal⍞000D            hd∊''⍺⍵∇'':⍺{⍵ all hd}acc ⍵           ⍝ Meta character.⍞000D            hd=''⍝'':⍺⍴acc ⍵                      ⍝ Comment⍞000D            ⍺{1}acc ⍵                           ⍝ Single char token⍞000D        }⍞000D        (0⍴⊂'''')lex,⍵⍞000D    }⍞000D⍞000D    1 disp 1 tokens2 ''1 2 3+4 5 6''    ⍝ numeric vectors as single token.⍞000D┌→────┬─┬─────┐⍞000D│1 2 3│+│4 5 6│⍞000D└────→┴→┴────→┘⍞000D    1 disp 0 tokens2 ''1 2 3+4 5 6''    ⍝ numeric vectors as multiple tokens.⍞000D┌→┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐⍞000D│1│ │2│ │3│+│4│ │5│ │6│⍞000D└→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┘⍞000D⍞000D    ⍪1 disp∘tokens2¨⎕NR''tokens2''⍞000D ┌→──────┬─┬─┬───┬─┬─┬──────────────────────────────┬─────────────────────────┐                            ⍞000D │tokens2│←│{│⎕ML│←│0│                              │⍝ Lex of APL source line.│                            ⍞000D └──────→┴→┴→┴──→┴→┴→┴─────────────────────────────→┴────────────────────────→┘                            ⍞000D ┌→───────┬─┬─┬─┬─┬─┬─┬──┬─┬─┬─┬───┬──────────────────────────┬────────────────────────────────┐           ⍞000D │        │⍺│←│0│ │⋄│ │nv│←│⍺│/│'' ''│                          │⍝ numeric vector as single tokn.│           ⍞000D └───────→┴→┴→┴→┴→┴→┴→┴─→┴→┴→┴→┴──→┴─────────────────────────→┴───────────────────────────────→┘           ⍞000D ┌→───────┬────┬─┬──┬─┬──┬─┬─────┬─┬──┬─┬──┬─┬───┬──────────────┬────────────────────┐                     ⍞000D │        │alph│←│⎕A│,│⎕Á│,│''_∆⍙''│,│26│↑│17│↓│⎕AV│              │⍝ Alphabet for names│                     ⍞000D └───────→┴───→┴→┴─→┴→┴─→┴→┴────→┴→┴─→┴→┴─→┴→┴──→┴─────────────→┴───────────────────→┘                     ⍞000D ┌→───────┬───┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬───────────────────────────┬─────────────────────┐                      ⍞000D │        │all│←│{│+│/│∧│\│⍺│∊│⍵│}│                           │⍝ ∇ No of leading ⍺∊⍵│                      ⍞000D └───────→┴──→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴──────────────────────────→┴────────────────────→┘                      ⍞000D ┌→───────┬───┬─┬─┬─┬─┬──┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬───┬─┬─┬─┬─┬─┬──────────┬───────────────────────┐      ⍞000D │        │acc│←│{│n│←│⍺⍺│ │⍵│ │⋄│ │(│⍺│,│⊂│n│↑│⍵│)│lex│ │n│↓│⍵│}│          │⍝ ∇∇ Accumulated tokens│      ⍞000D └───────→┴──→┴→┴→┴→┴→┴─→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴──→┴→┴→┴→┴→┴→┴─────────→┴──────────────────────→┘      ⍞000D ┌→───────┬───┬─┬─┬───────────────────────────────────┬──────────────────────┐                             ⍞000D │        │lex│←│{│                                   │⍝ ∇ Next lexical token│                             ⍞000D └───────→┴──→┴→┴→┴──────────────────────────────────→┴─────────────────────→┘                             ⍞000D ┌→───────────┬─┬─┬─┬─┬─┬─┬─┬─┬─┬──┬─┬─┬─┬──────────────────────┬─────────────────────────┐                ⍞000D │            │0│=│⍴│⍵│:│⍺│ │⋄│ │hd│←│⊃│⍵│                      │⍝ Next char else finished│                ⍞000D └───────────→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴─→┴→┴→┴→┴─────────────────────→┴────────────────────────→┘                ⍞000D ┌→───────────┬──┬─┬───┬─┬─┬─┬─┬─┬───┬───┬─┬───┬─┬─┬─────────────┬─────────────┐                           ⍞000D │            │hd│=│'' ''│:│⍺│{│⍵│ │all│'' ''│}│acc│ │⍵│             │⍝ White Space│                           ⍞000D └───────────→┴─→┴→┴──→┴→┴→┴→┴→┴→┴──→┴──→┴→┴──→┴→┴→┴────────────→┴────────────→┘                           ⍞000D ┌→───────────┬──┬─┬────┬─┬─┬─┬─┬─┬───┬─┬────┬─┬──┬─┬───┬─┬─┬───────┬──────┐                               ⍞000D │            │hd│∊│alph│:│⍺│{│⍵│ │all│ │alph│,│⎕D│}│acc│ │⍵│       │⍝ Name│                               ⍞000D └───────────→┴─→┴→┴───→┴→┴→┴→┴→┴→┴──→┴→┴───→┴→┴─→┴→┴──→┴→┴→┴──────→┴─────→┘                               ⍞000D ┌→───────────┬──┬─┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬───┬─┬────┬─┬───┬─┬───┬─┬─┬─┬───────────────────────────────┐ ⍞000D │            │hd│∊│''⎕:''│:│⍺│{│1│+│(│1│↓│⍵│)│all│ │alph│,│'':''│}│acc│ │⍵│ │⍝ System Name / Keyword / guard│ ⍞000D └───────────→┴─→┴→┴───→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴──→┴→┴───→┴→┴──→┴→┴──→┴→┴→┴→┴──────────────────────────────→┘ ⍞000D ┌→───────────┬──┬─┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬──┬─┬─┬─┬─┬─┬─┬─┬──┬─┬───┬─┬─┬──┬──────────────┐              ⍞000D │            │hd│=│''''''''│:│⍺│{│+│/│∧│\│{│⍵│∨│¯1│⌽│⍵│}│≠│\│⍵│=│hd│}│acc│ │⍵│  │⍝ Char literal│              ⍞000D └───────────→┴─→┴→┴───→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴─→┴→┴→┴→┴→┴→┴→┴→┴─→┴→┴──→┴→┴→┴─→┴─────────────→┘              ⍞000D ┌→───────────┬──┬─┬──┬─┬───┬─┬─┬─┬─┬─┬───┬─┬──┬─┬─────┬─┬──┬─┬───┬─┬─┬─┬────────────────────────┐         ⍞000D │            │hd│∊│⎕D│,│''¯''│:│⍺│{│⍵│ │all│ │⎕D│,│''.¯E''│,│nv│}│acc│ │⍵│ │⍝ Numeric scalar literal│         ⍞000D └───────────→┴─→┴→┴─→┴→┴──→┴→┴→┴→┴→┴→┴──→┴→┴─→┴→┴────→┴→┴─→┴→┴──→┴→┴→┴→┴───────────────────────→┘         ⍞000D ┌→───────────┬──┬─┬─────┬─┬─┬─┬─┬─┬───┬─┬──┬─┬───┬─┬─┬───────────┬─────────────────┐                      ⍞000D │            │hd│∊│''⍺⍵∇''│:│⍺│{│⍵│ │all│ │hd│}│acc│ │⍵│           │⍝ Meta character.│                      ⍞000D └───────────→┴─→┴→┴────→┴→┴→┴→┴→┴→┴──→┴→┴─→┴→┴──→┴→┴→┴──────────→┴────────────────→┘                      ⍞000D ┌→───────────┬──┬─┬───┬─┬─┬─┬───┬─┬─┬──────────────────────┬─────────┐                                    ⍞000D │            │hd│=│''⍝''│:│⍺│⍴│acc│ │⍵│                      │⍝ Comment│                                    ⍞000D └───────────→┴─→┴→┴──→┴→┴→┴→┴──→┴→┴→┴─────────────────────→┴────────→┘                                    ⍞000D ┌→───────────┬─┬─┬─┬─┬───┬─┬─┬───────────────────────────┬───────────────────┐                            ⍞000D │            │⍺│{│1│}│acc│ │⍵│                           │⍝ Single char token│                            ⍞000D └───────────→┴→┴→┴→┴→┴──→┴→┴→┴──────────────────────────→┴──────────────────→┘                            ⍞000D ┌→───────┬─┐                                                                                              ⍞000D │        │}│                                                                                              ⍞000D └───────→┴→┘                                                                                              ⍞000D ┌→───────┬─┬─┬─┬─┬──┬─┬───┬─┬─┐                                                                           ⍞000D │        │(│0│⍴│⊂│''''│)│lex│,│⍵│                                                                           ⍞000D └───────→┴→┴→┴→┴→┴─→┴→┴──→┴→┴→┘                                                                           ⍞000D ┌→───┬─┐                                                                                                  ⍞000D │    │}│                                                                                                  ⍞000D └───→┴→┘                                                                                                  ' 
