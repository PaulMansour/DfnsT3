'⍝ Remove comment from line of APL:⍞000D⍞000D      ⎕ml←0⍞000D⍞000D      display ⎕cr''rmcm''⍞000D┌→──────────────────────────────────────────────────────────────────────┐⍞000D↓rmcm←{                          ⍝ APL source with comments removed.    │⍞000D│    cm←∨\(⍵=''⍝'')>≠\⍵=''''''''       ⍝ mask of comments.                    │⍞000D│    ⎕UCS(cm×32)+(~cm)×⎕UCS ⍵    ⍝ blanks for comments in source matrix.│⍞000D│}                                                                      │⍞000D└───────────────────────────────────────────────────────────────────────┘⍞000D      display rmcm ⎕cr''rmcm''⍞000D┌→──────────────────────────────────────────────────────────────────────┐⍞000D↓rmcm←{                                                                 │⍞000D│    cm←∨\(⍵=''⍝'')>≠\⍵=''''''''                                              │⍞000D│    ⎕UCS(cm×32)+(~cm)×⎕UCS ⍵                                           │⍞000D│}                                                                      │⍞000D└───────────────────────────────────────────────────────────────────────┘⍞000D⍞000D      dup←{       ⍝ blah, blah,⍞000D                  ⍝ blah, blah,⍞000D⍞000D          ⍵ ⍵     ⍝ blah, blah,⍞000D⍞000D                  ⍝ blah, blah.⍞000D⍞000D                  ⍝ (c) C-A.S.⍞000D      }⍞000D⍞000D      clean_fn←{⎕fx(dtb∘rmcm¨⎕nr ⍵)~⊂''''}    ⍝ remove white space from function.⍞000D⍞000D      clean_fn''dup''                     ⍝ remove comments and blank lines.⍞000Ddup⍞000D⍞000D      display ⎕cr''dup''                  ⍝ uncommented function.⍞000D┌→────────────┐⍞000D↓dup←{        │⍞000D│          ⍵ ⍵│⍞000D│      }      │⍞000D└─────────────┘⍞000D⍞000D      one_liner←{⎕ML←0                  ⍝ Turn function into 1-liner.⍞000D          ⎕FX↑,↓{                       ⍝ fix:⍞000D              bd←''{⋄'' ''{''               ⍝ brace-diamond → brace⍞000D              db←''⋄}'' ''}''               ⍝ diamond-brace → brace⍞000D              ↑subs/bd db ⍵             ⍝ substitution in⍞000D          }↑{⍺,''⋄'',⍵}/⎕NR ⍵             ⍝ diamond-joined lines.⍞000D      }⍞000D⍞000D      display ⎕cr one_liner clean_fn''display''⍞000D┌→──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐⍞000D↓display←{⎕IO ⎕ML←0 1 ⋄ box←{vrt hrz←(¯1+⍴⍵)⍴¨''│─'' ⋄ top←''─⊖→''[¯1↑⍺],hrz ⋄ bot←(⊃⍺),hrz ⋄ rgt←''┐│'',vrt,''┘'' ⋄ lax←''│⌽↓''[¯1↓1↓⍺],¨⊂vrt ⋄ lft←⍉''┌'',(↑lax),''└'' ⋄ lft,(top⍪⍵⍪bot),rgt ⋄ } ⋄ deco←{⍺←type open ⍵ ⋄ ⍺,axes ⍵} ⋄ axes←{(-2⌈⍴⍴⍵)↑1+×⍴⍵} ⋄ open←{16::(1⌈⍴⍵)⍴⊂''[ref]'' ⋄ (1⌈⍴⍵)⍴⍵} ⋄ trim←{(~1 1⍷∧⌿⍵='' '')/⍵} ⋄ type←{{(1=⍴⍵)⊃''+''⍵}∪,char¨⍵} ⋄ char←{⍬≡⍴⍵:''─'' ⋄ (⊃⍵∊''¯'',⎕D)⊃''#~''}∘⍕ ⋄ line←{(6≠10|⎕DR'' ''⍵)⊃'' -''} ⋄ {0=≡⍵:'' ''⍪(open ⎕FMT ⍵)⍪line ⍵ ⋄ 1 ⍬≡(≡⍵)(⍴⍵):''∇'' 0 0 box ⎕FMT ⍵ ⋄ 1=≡⍵:(deco ⍵)box open ⎕FMT open ⍵ ⋄ (''∊''deco ⍵)box trim ⎕FMT ∇¨open ⍵ ⋄ }⍵}│⍞000D└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘⍞000D⍞000D⍝ JoHo''s expression to remove comments from all trad- and dfns and operators:⍞000D⍞000D      disp ⎕cr¨''gcd'' ''osc''      ⍝ before: commented fns⍞000D┌──────────────────────────────────────┬─────────────────────────────────────────────────────┐⍞000D│gcd←{       ⍝ Greatest common divisor.│osc←{               ⍝ Oscillate - probably returns 1.│⍞000D│    ⍵=0:|⍺                            │    1=⍵:1                                            │⍞000D│    ⍵ ∇ ⍵|⍺                           │    2|⍵:∇ 1+3×⍵                                      │⍞000D│}                                     │        ∇ ⍵÷2                                        │⍞000D│                                      │}                                                    │⍞000D└──────────────────────────────────────┴─────────────────────────────────────────────────────┘⍞000D⍞000D      pco←⊢     ⍝ pco has a very large ⎕CR; zap it to reduce test time.⍞000D⍞000D      rmcm(refs ⎕this).{⍺⍺{0=⍴⍵: ⋄ ⎕fx∘⍺⍺∘⎕cr¨⍵}⎕nl-,⍵∘.+0.1 0.2}⊂3 4⍞000D⍞000D      disp ⎕cr¨''gcd'' ''osc''      ⍝ after: uncommented fns⍞000D┌───────────┬───────────────┐⍞000D│gcd←{      │osc←{          │⍞000D│    ⍵=0:|⍺ │    1=⍵:1      │⍞000D│    ⍵ ∇ ⍵|⍺│    2|⍵:∇ 1+3×⍵│⍞000D│}          │        ∇ ⍵÷2  │⍞000D│           │}              │⍞000D└───────────┴───────────────┘' 
