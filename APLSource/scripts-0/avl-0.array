'⍝ Insert value ⍵ in AVL tree ⍺:⍞000D⍞000D    put ← ∪ avl     ⍝ :: tree ← tree ∇ key value⍞000D    rem ← ~ avl     ⍝ :: tree ← tree ∇ key⍞000D    get ← ⍎ avl     ⍝ :: value ← tree ∇ key⍞000D    chk ← ? avl     ⍝ :: ok height maxbal ← ∇ tree⍞000D    fmt ← ⍕ avl     ⍝ :: cmat ← ∇ tree⍞000D    vec ← ∊ avl     ⍝ :: (key val)[] ← ∇ tree⍞000D⍞000D    tree←0∘(put foldl)          ⍝ tree from vector of keys.⍞000D⍞000D    disp tree ⍳7⍞000D┌─┬─┬─────────────────────────────────────────────────────────┐⍞000D│4│0│┌───────────────────────────┬───────────────────────────┐│⍞000D│ │ ││┌─┬─┬─────────────────────┐│┌─┬─┬─────────────────────┐││⍞000D│ │ │││2│0│┌─────────┬─────────┐│││6│0│┌─────────┬─────────┐│││⍞000D│ │ │││ │ ││┌─┬─┬───┐│┌─┬─┬───┐││││ │ ││┌─┬─┬───┐│┌─┬─┬───┐││││⍞000D│ │ │││ │ │││1│0│0 0│││3│0│0 0│││││ │ │││5│0│0 0│││7│0│0 0│││││⍞000D│ │ │││ │ ││└─┴─┴───┘│└─┴─┴───┘││││ │ ││└─┴─┴───┘│└─┴─┴───┘││││⍞000D│ │ │││ │ │└─────────┴─────────┘│││ │ │└─────────┴─────────┘│││⍞000D│ │ ││└─┴─┴─────────────────────┘│└─┴─┴─────────────────────┘││⍞000D│ │ │└───────────────────────────┴───────────────────────────┘│⍞000D└─┴─┴─────────────────────────────────────────────────────────┘⍞000D⍞000D    fmt tree ⍳7⍞000D        ┌─1=1⍞000D   ┌─2=2┤    ⍞000D   │    └─3=3⍞000D4=4┤         ⍞000D   │    ┌─5=5⍞000D   └─6=6┤    ⍞000D        └─7=7⍞000D⍞000D    kseq ← 1↓¨,\'' '',12↑⎕a           ⍝ key sequence.⍞000D⍞000D    disp kseq⍞000D┌┬─┬──┬───┬────┬─────┬──────┬───────┬────────┬─────────┬──────────┬───────────┬────────────┐⍞000D││A│AB│ABC│ABCD│ABCDE│ABCDEF│ABCDEFG│ABCDEFGH│ABCDEFGHI│ABCDEFGHIJ│ABCDEFGHIJK│ABCDEFGHIJKL│⍞000D└┴─┴──┴───┴────┴─────┴──────┴───────┴────────┴─────────┴──────────┴───────────┴────────────┘⍞000D⍞000D    disp fmt∘tree¨ kseq             ⍝ successive inserts A B C ...⍞000D┌┬───┬────────┬────────┬─────────────┬─────────────┬─────────────┬─────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────┐⍞000D││A=A│A=A┐    │   ┌─A=A│   ┌<A=A     │   ┌<A=A     │        ┌─A=A│        ┌─A=A│        ┌─A=A     │        ┌─A=A     │        ┌─A=A     │        ┌─A=A     │             ┌─A=A│⍞000D││   │   └>B=B│B=B┤    │B=B┤         │B=B┤         │   ┌─B=B┤    │   ┌─B=B┤    │   ┌<B=B┤         │   ┌<B=B┤         │   ┌<B=B┤         │   ┌<B=B┤         │        ┌─B=B┤    │⍞000D││   │        │   └─C=C│   └>C=C┐    │   │    ┌─C=C│   │    └─C=C│   │    └─C=C│   │    └─C=C     │   │    └─C=C     │   │    └─C=C     │   │    └─C=C     │        │    └─C=C│⍞000D││   │        │        │        └>D=D│   └>D=D┤    │D=D┤         │D=D┤         │D=D┤              │D=D┤              │D=D┤              │D=D┤              │   ┌─D=D┤         │⍞000D││   │        │        │             │        └─E=E│   └─E=E┐    │   │    ┌─E=E│   │    ┌<E=E     │   │    ┌<E=E     │   │         ┌─E=E│   │         ┌─E=E│   │    │    ┌─E=E│⍞000D││   │        │        │             │             │        └>F=F│   └─F=F┤    │   └>F=F┤         │   └>F=F┤         │   │    ┌─F=F┤    │   │    ┌─F=F┤    │   │    └─F=F┤    │⍞000D││   │        │        │             │             │             │        └─G=G│        └>G=G┐    │        │    ┌─G=G│   │    │    └─G=G│   │    │    └─G=G│   │         └─G=G│⍞000D││   │        │        │             │             │             │             │             └>H=H│        └>H=H┤    │   └>H=H┤         │   └>H=H┤         │H=H┤              │⍞000D││   │        │        │             │             │             │             │                  │             └─I=I│        └─I=I┐    │        │    ┌─I=I│   │    ┌<I=I     │⍞000D││   │        │        │             │             │             │             │                  │                  │             └>J=J│        └─J=J┤    │   └─J=J┤         │⍞000D││   │        │        │             │             │             │             │                  │                  │                  │             └─K=K│        └>K=K┐    │⍞000D││   │        │        │             │             │             │             │                  │                  │                  │                  │             └>L=L│⍞000D└┴───┴────────┴────────┴─────────────┴─────────────┴─────────────┴─────────────┴──────────────────┴──────────────────┴──────────────────┴──────────────────┴──────────────────┘⍞000D⍞000D    disp (tree 12↑⎕a){fmt ⍺⍺ rem foldl ⍵}¨kseq      ⍝ successive removals A B ..⍞000D┌──────────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────┬─────────────┬─────────────┬─────────────┬────────┬────────┬───┬┐⍞000D│             ┌─A=A│        ┌─B=B┐    │        ┌<C=C     │        ┌>D=D┐    │        ┌─E=E     │   ┌<F=F┐         │        ┌─G=G│   ┌─H=H┐    │   ┌<I=I     │   ┌─J=J│K=K┐    │L=L││⍞000D│        ┌─B=B┤    │        │    └>C=C│   ┌─D=D┤         │        │    └>E=E│   ┌<F=F┤         │   │    └>G=G     │   ┌─H=H┤    │   │    └>I=I│J=J┤         │K=K┤    │   └>L=L│   ││⍞000D│        │    └─C=C│   ┌─D=D┤         │   │    │    ┌─E=E│   ┌─F=F┤         │   │    └─G=G     │H=H┤              │   │    └─I=I│J=J┤         │   └>K=K┐    │   └─L=L│        │   ││⍞000D│   ┌─D=D┤         │   │    │    ┌─E=E│   │    └>F=F┤    │   │    └<G=G     │H=H┤              │   │    ┌<I=I     │J=J┤         │   └─K=K┐    │        └>L=L│        │        │   ││⍞000D│   │    │    ┌─E=E│   │    └─F=F┤    │   │         └─G=G│H=H┤              │   │    ┌<I=I     │   └>J=J┤         │   └─K=K┐    │        └>L=L│             │        │        │   ││⍞000D│   │    └─F=F┤    │   │         └─G=G│H=H┤              │   │    ┌<I=I     │   └>J=J┤         │        └>K=K┐    │        └>L=L│             │             │        │        │   ││⍞000D│   │         └─G=G│H=H┤              │   │    ┌<I=I     │   └─J=J┤         │        └>K=K┐    │             └>L=L│             │             │             │        │        │   ││⍞000D│H=H┤              │   │    ┌<I=I     │   └─J=J┤         │        └>K=K┐    │             └>L=L│                  │             │             │             │        │        │   ││⍞000D│   │    ┌<I=I     │   └─J=J┤         │        └>K=K┐    │             └>L=L│                  │                  │             │             │             │        │        │   ││⍞000D│   └─J=J┤         │        └>K=K┐    │             └>L=L│                  │                  │                  │             │             │             │        │        │   ││⍞000D│        └>K=K┐    │             └>L=L│                  │                  │                  │                  │             │             │             │        │        │   ││⍞000D│             └>L=L│                  │                  │                  │                  │                  │             │             │             │        │        │   ││⍞000D└──────────────────┴──────────────────┴──────────────────┴──────────────────┴──────────────────┴──────────────────┴─────────────┴─────────────┴─────────────┴────────┴────────┴───┴┘⍞000D⍞000D⍝ successive removals of root node:⍞000D⍞000D    disp (tree 12↑⎕a){fmt ⍺⍺ rem foldl ⍵}¨,\'' HIJDEFGKBCLA''⍞000D┌──────────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────┬─────────────┬─────────────┬─────────────┬─────────────┬────────┬────────┬───┬┐⍞000D│             ┌─A=A│             ┌─A=A│             ┌─A=A│        ┌─A=A     │        ┌─A=A     │        ┌─A=A│        ┌─A=A│        ┌─A=A│   ┌<A=A     │   ┌─A=A│   ┌>A=A│A=A││⍞000D│        ┌─B=B┤    │        ┌─B=B┤    │        ┌─B=B┤    │   ┌<B=B┤         │   ┌<B=B┤         │   ┌─B=B┤    │   ┌─B=B┤    │   ┌>B=B┤    │B=B┤         │C=C┤    │L=L┘    │   ││⍞000D│        │    └─C=C│        │    └─C=C│        │    └─C=C│   │    └─C=C     │   │    └─C=C     │   │    └─C=C│   │    └─C=C│   │    └─C=C│   │    ┌>C=C│   └─L=L│        │   ││⍞000D│   ┌─D=D┤         │   ┌>D=D┤         │   ┌>D=D┤         │D=D┤              │E=E┤              │F=F┤         │G=G┤         │K=K┤         │   └>L=L┘    │        │        │   ││⍞000D│   │    │    ┌─E=E│   │    │    ┌─E=E│   │    │    ┌─E=E│   │         ┌─E=E│   │    ┌>F=F┐    │   │    ┌─G=G│   └─K=K┐    │   └<L=L     │             │        │        │   ││⍞000D│   │    └─F=F┤    │   │    └─F=F┤    │   │    └─F=F┤    │   │    ┌>F=F┤    │   │    │    └>G=G│   └─K=K┤    │        └>L=L│             │             │        │        │   ││⍞000D│   │         └─G=G│   │         └─G=G│   │         └─G=G│   │    │    └─G=G│   └>K=K┤         │        └─L=L│             │             │             │        │        │   ││⍞000D│H=H┤              │I=I┤              │J=J┤              │   └>K=K┤         │        └<L=L     │             │             │             │             │        │        │   ││⍞000D│   │    ┌<I=I     │   │    ┌─J=J     │   └<K=K┐         │        └<L=L     │                  │             │             │             │             │        │        │   ││⍞000D│   └─J=J┤         │   └<K=K┤         │        └>L=L     │                  │                  │             │             │             │             │        │        │   ││⍞000D│        └>K=K┐    │        └─L=L     │                  │                  │                  │             │             │             │             │        │        │   ││⍞000D│             └>L=L│                  │                  │                  │                  │             │             │             │             │        │        │   ││⍞000D└──────────────────┴──────────────────┴──────────────────┴──────────────────┴──────────────────┴─────────────┴─────────────┴─────────────┴─────────────┴────────┴────────┴───┴┘⍞000D⍞000D    display fmt tree ⎕a⍞000D┌→──────────────────────┐⍞000D↓                  ┌─A=A│⍞000D│             ┌─B=B┤    │⍞000D│             │    └─C=C│⍞000D│        ┌─D=D┤         │⍞000D│        │    │    ┌─E=E│⍞000D│        │    └─F=F┤    │⍞000D│        │         └─G=G│⍞000D│   ┌─H=H┤              │⍞000D│   │    │         ┌─I=I│⍞000D│   │    │    ┌─J=J┤    │⍞000D│   │    │    │    └─K=K│⍞000D│   │    └─L=L┤         │⍞000D│   │         │    ┌─M=M│⍞000D│   │         └─N=N┤    │⍞000D│   │              └─O=O│⍞000D│P=P┤                   │⍞000D│   │         ┌─Q=Q     │⍞000D│   │    ┌<R=R┤         │⍞000D│   │    │    └─S=S     │⍞000D│   └─T=T┤              │⍞000D│        │         ┌─U=U│⍞000D│        │    ┌─V=V┤    │⍞000D│        │    │    └─W=W│⍞000D│        └>X=X┤         │⍞000D│             └─Y=Y┐    │⍞000D│                  └>Z=Z│⍞000D└───────────────────────┘⍞000D⍞000D    disp fmt¨ ∪ tree¨↓pmat 5                    ⍝ test double rotation.⍞000D┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐⍞000D│   ┌<1=1     │   ┌─1=1┐    │   ┌─1=1┐    │        ┌─1=1│        ┌>1=1│        ┌>1=1│⍞000D│2=2┤         │   │    └>2=2│   │    └>2=2│   ┌>2=2┤    │   ┌─2=2┘    │   ┌─2=2┘    │⍞000D│   │    ┌─3=3│3=3┤         │3=3┤         │   │    └─3=3│3=3┤         │3=3┤         │⍞000D│   └>4=4┤    │   └─4=4┐    │   │    ┌>4=4│4=4┤         │   └─4=4┐    │   │    ┌>4=4│⍞000D│        └─5=5│        └>5=5│   └─5=5┘    │   └<5=5     │        └>5=5│   └─5=5┘    │⍞000D└─────────────┴─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘⍞000D⍞000D    tt←tree (''one''1) (''two''2) (''three''3) (''four''4) (''five''5) (''six''6) (''seven''7)⍞000D⍞000D    display fmt tt⍞000D┌→─────────────────────────────┐⍞000D↓             ┌>five=5         │⍞000D│     ┌<four=4┘                │⍞000D│one=1┤                        │⍞000D│     │               ┌>seven=7│⍞000D│     │        ┌>six=6┘        │⍞000D│     └>three=3┤               │⍞000D│              └<two=2         │⍞000D└──────────────────────────────┘⍞000D⍞000D    disp vec tt                             ⍝ enlist of tree.⍞000D┌────────┬────────┬───────┬─────────┬───────┬─────────┬───────┐⍞000D│┌────┬─┐│┌────┬─┐│┌───┬─┐│┌─────┬─┐│┌───┬─┐│┌─────┬─┐│┌───┬─┐│⍞000D││five│5│││four│4│││one│1│││seven│7│││six│6│││three│3│││two│2││⍞000D│└────┴─┘│└────┴─┘│└───┴─┘│└─────┴─┘│└───┴─┘│└─────┴─┘│└───┴─┘│⍞000D└────────┴────────┴───────┴─────────┴───────┴─────────┴───────┘⍞000D⍞000D    tt ← tt put foldl (''one'' 11)(''two'' 22)(''three''33)⍞000D⍞000D    display fmt tt⍞000D┌→───────────────────────────────┐⍞000D↓              ┌>five=5          │⍞000D│      ┌<four=4┘                 │⍞000D│one=11┤                         │⍞000D│      │                ┌>seven=7│⍞000D│      │         ┌>six=6┘        │⍞000D│      └>three=33┤               │⍞000D│                └<two=22        │⍞000D└────────────────────────────────┘⍞000D⍞000D    0 ≡ tt rem foldl ''seven'' ''six'' ''five'' ''four'' ''one'' ''two'' ''three''⍞000D1⍞000D    0 ≡ tt rem foldl ''six'' ''four'' ''seven'' ''three'' ''five'' ''one'' ''two''⍞000D1⍞000D⍞000D    tt∘get¨ ''two'' ''four'' ''six''              ⍝ search tree for keys.⍞000D22 4 6⍞000D⍞000D    tt get ''eight''                          ⍝ key not in tree.⍞000D6::VALUE ERROR⍞000D⍞000D    chk tt                                  ⍝ ok size mean_depth height.⍞000D1 7 2 4⍞000D⍞000D    fib←{                           ⍝ Depth-⍵ worst-case fibonacci tree.⍞000D        ⊃⍬⍴⎕io{                     ⍝ first item is tree.⍞000D            ⍵=0:0 ⍺                 ⍝ f 0 → []⍞000D            ⍵=1:(⍺ 0(0 0))(⍺+1)     ⍝ f 1 → ⍺ [] []⍞000D            l m←⍺ ∇ ⍵-2             ⍝ left subtree and next value⍞000D            r n←(m+1)∇ ⍵-1          ⍝ right ..  ..  ..  ..  ..⍞000D            (m 1(l r))n             ⍝ f ⍵+1 → ⍺ [f ⍵-2] [f ⍵-1]⍞000D        }⍵                          ⍝ :: tree next ← next ∇ depth⍞000D    }⍞000D⍞000D    display fmt fib 7               ⍝ depth-7 worst-case.⍞000D┌→──────────────────────────────────────────────┐⍞000D↓               ┌<1=1                           │⍞000D│          ┌<2=2┤                               │⍞000D│          │    └>3=3┐                          │⍞000D│          │         └>4=4                      │⍞000D│     ┌<5=5┤                                    │⍞000D│     │    │    ┌<6=6┐                          │⍞000D│     │    │    │    └>7=7                      │⍞000D│     │    └>8=8┤                               │⍞000D│     │         │      ┌<9=9                    │⍞000D│     │         └>10=10┤                        │⍞000D│     │                └>11=11┐                 │⍞000D│     │                       └>12=12           │⍞000D│13=13┤                                         │⍞000D│     │             ┌<14=14┐                    │⍞000D│     │             │      └>15=15              │⍞000D│     │      ┌<16=16┤                           │⍞000D│     │      │      │      ┌<17=17              │⍞000D│     │      │      └>18=18┤                    │⍞000D│     │      │             └>19=19┐             │⍞000D│     │      │                    └>20=20       │⍞000D│     └>21=21┤                                  │⍞000D│            │             ┌<22=22              │⍞000D│            │      ┌<23=23┤                    │⍞000D│            │      │      └>24=24┐             │⍞000D│            │      │             └>25=25       │⍞000D│            └>26=26┤                           │⍞000D│                   │      ┌<27=27┐             │⍞000D│                   │      │      └>28=28       │⍞000D│                   └>29=29┤                    │⍞000D│                          │      ┌<30=30       │⍞000D│                          └>31=31┤             │⍞000D│                                 └>32=32┐      │⍞000D│                                        └>33=33│⍞000D└───────────────────────────────────────────────┘⍞000D⍞000D    display fmt (fib 7)rem 1        ⍝ removing worst-case node.⍞000D┌→───────────────────────────────────────┐⍞000D↓                           ┌─2=2        │⍞000D│                      ┌─3=3┤            │⍞000D│                      │    └─4=4        │⍞000D│                 ┌─5=5┤                 │⍞000D│                 │    └─6=6┐            │⍞000D│                 │         └>7=7        │⍞000D│            ┌─8=8┤                      │⍞000D│            │    │      ┌<9=9           │⍞000D│            │    └─10=10┤               │⍞000D│            │           └>11=11┐        │⍞000D│            │                  └>12=12  │⍞000D│     ┌─13=13┤                           │⍞000D│     │      │      ┌<14=14┐             │⍞000D│     │      │      │      └>15=15       │⍞000D│     │      └─16=16┤                    │⍞000D│     │             │      ┌<17=17       │⍞000D│     │             └>18=18┤             │⍞000D│     │                    └>19=19┐      │⍞000D│     │                           └>20=20│⍞000D│21=21┤                                  │⍞000D│     │             ┌<22=22              │⍞000D│     │      ┌<23=23┤                    │⍞000D│     │      │      └>24=24┐             │⍞000D│     │      │             └>25=25       │⍞000D│     └─26=26┤                           │⍞000D│            │      ┌<27=27┐             │⍞000D│            │      │      └>28=28       │⍞000D│            └>29=29┤                    │⍞000D│                   │      ┌<30=30       │⍞000D│                   └>31=31┤             │⍞000D│                          └>32=32┐      │⍞000D│                                 └>33=33│⍞000D└────────────────────────────────────────┘⍞000D⍞000D    Alpha test ''_BST''                       ⍝ common BST tests.⍞000D1' 
