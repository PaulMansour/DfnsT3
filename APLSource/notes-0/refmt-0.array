'crep ← {tabs csep←4} ##.refmt crep          ⍝ Reformat dfn/op representation.⍞000D⍞000DReformats  the (possibly nested) canonical representation of D-function or oper-⍞000Dator [crep]. The optional left argument (default 4) specifies:⍞000D⍞000D    [tabs] the indentation width for nested inner functions and⍞000D    [csep] the number of blank columns to separate code from comment lines.⍞000D⍞000DA  previous version of this function, which took and returned the name of a fun-⍞000Dction to be reformatted, can be composed:⍞000D⍞000D    old_refmt ← ⎕fx∘refmt∘⎕cr⍞000D⍞000DNB:  If  [AutoFormat functions]  is  checked in the session''s Options→Configure→⍞000DTrace/Edit tab, the system will reimpose its own canonical formatting style when⍞000Dfunctions  are fixed. To preserve "non-standard" formatting, uncheck the box and⍞000Dtry again.⍞000D⍞000DExamples:⍞000D⍞000D      display ⎕cr''refmt''                ⍝ unformatted dfn.⍞000D┌→────────────────────────────────────────────────────────────────────┐⍞000D↓refmt←{⎕IO ⎕ML←0                ⍝ Reformat dfn/op.                   │⍞000D│    ⍺←4 ⋄ dent csep←⍺             ⍝ default indents and ⍝-separation.│⍞000D│   ⎕FX{                          ⍝ refix function.                   │⍞000D│   unqt←{~≠\⍵=''''''''}            ⍝ mask of unquoted tokens.            │⍞000D│    code coms←↓⍉↑{              ⍝ code and comment vectors.          │⍞000D│      umsk←unqt ⍵               ⍝ unquoted chars.                    │⍞000D│    cmsk←∨\umsk∧⍵=''⍝''         ⍝ comment mask.                        │⍞000D│      code coms←(0 1=⊂cmsk)/¨⊂⍵ ⍝ code / comments.                   │⍞000D│      rlb←{(∨\⍵≠'' '')/⍵}         ⍝ remove leading blanks.             │⍞000D│    clean←⌽rlb⌽rlb code       ⍝ cleaned code.                        │⍞000D│      clean coms                ⍝ clean code / comment.              │⍞000D│    }¨⍵                         ⍝ for each line.                     │⍞000D│    dents←{                     ⍝ indentation for each line          │⍞000D│       toks←(unqt ⍵){⍺\⍺/⍵}⍵     ⍝ unquoted code characters.         │⍞000D│       dvec←-⌿0 1⌽+\''{}''∘.=toks  ⍝ brace-depth of each token.        │⍞000D│     lmask←toks=''·''            ⍝ start of each line.                 │⍞000D│      (dent×lmask/dvec)/¨'' ''    ⍝ indentation for each line.         │⍞000D│    }↑,/''·'',¨code               ⍝ collected code vector.             │⍞000D│     scoms←(⊂csep⍴'' ''),¨coms     ⍝ separated comments.               │⍞000D│     icode←↓↑dents,¨code         ⍝ indented code lines.              │⍞000D│    icode,¨scoms                ⍝ reunited code and comments.        │⍞000D│  }⎕NR ⍵                        ⍝ lines of function.                 │⍞000D│}                                                                    │⍞000D└─────────────────────────────────────────────────────────────────────┘⍞000D⍞000D      display 4 refmt ⎕cr''refmt''        ⍝ generous formatting.⍞000D┌→───────────────────────────────────────────────────────────────────────────┐⍞000D↓refmt←{⎕IO ⎕ML←0                         ⍝ Reformat dfn/op.                 │⍞000D│    ⍺←4 ⋄ dent csep←⍺                    ⍝ default indents and ⍝-separation.│⍞000D│    ⎕FX{                                 ⍝ refix function.                  │⍞000D│        unqt←{~≠\⍵=''''''''}                 ⍝ mask of unquoted tokens.         │⍞000D│        code coms←↓⍉↑{                   ⍝ code and comment vectors.        │⍞000D│            umsk←unqt ⍵                  ⍝ unquoted chars.                  │⍞000D│            cmsk←∨\umsk∧⍵=''⍝''            ⍝ comment mask.                    │⍞000D│            code coms←(0 1=⊂cmsk)/¨⊂⍵    ⍝ code / comments.                 │⍞000D│            rlb←{(∨\⍵≠'' '')/⍵}            ⍝ remove leading blanks.           │⍞000D│            clean←⌽rlb⌽rlb code          ⍝ cleaned code.                    │⍞000D│            clean coms                   ⍝ clean code / comment.            │⍞000D│        }¨⍵                              ⍝ for each line.                   │⍞000D│        dents←{                          ⍝ indentation for each line        │⍞000D│            toks←(unqt ⍵){⍺\⍺/⍵}⍵        ⍝ unquoted code characters.        │⍞000D│            dvec←-⌿0 1⌽+\''{}''∘.=toks     ⍝ brace-depth of each token.       │⍞000D│            lmask←toks=''·''               ⍝ start of each line.              │⍞000D│            (dent×lmask/dvec)/¨'' ''       ⍝ indentation for each line.       │⍞000D│        }↑,/''·'',¨code                    ⍝ collected code vector.           │⍞000D│        scoms←(⊂csep⍴'' ''),¨coms          ⍝ separated comments.              │⍞000D│        icode←↓↑dents,¨code              ⍝ indented code lines.             │⍞000D│        icode,¨scoms                     ⍝ reunited code and comments.      │⍞000D│    }⎕NR ⍵                               ⍝ lines of function.               │⍞000D│}                                                                           │⍞000D└────────────────────────────────────────────────────────────────────────────┘⍞000D⍞000D      display 2 1 refmt ⎕cr''refmt''      ⍝ frugal formatting.⍞000D┌→──────────────────────────────────────────────────────────────────┐⍞000D↓refmt←{⎕IO ⎕ML←0                ⍝ Reformat dfn/op.                 │⍞000D│  ⍺←4 ⋄ dent csep←⍺             ⍝ default indents and ⍝-separation.│⍞000D│  ⎕FX{                          ⍝ refix function.                  │⍞000D│    unqt←{~≠\⍵=''''''''}            ⍝ mask of unquoted tokens.         │⍞000D│    code coms←↓⍉↑{              ⍝ code and comment vectors.        │⍞000D│      umsk←unqt ⍵               ⍝ unquoted chars.                  │⍞000D│      cmsk←∨\umsk∧⍵=''⍝''         ⍝ comment mask.                    │⍞000D│      code coms←(0 1=⊂cmsk)/¨⊂⍵ ⍝ code / comments.                 │⍞000D│      rlb←{(∨\⍵≠'' '')/⍵}         ⍝ remove leading blanks.           │⍞000D│      clean←⌽rlb⌽rlb code       ⍝ cleaned code.                    │⍞000D│      clean coms                ⍝ clean code / comment.            │⍞000D│    }¨⍵                         ⍝ for each line.                   │⍞000D│    dents←{                     ⍝ indentation for each line        │⍞000D│      toks←(unqt ⍵){⍺\⍺/⍵}⍵     ⍝ unquoted code characters.        │⍞000D│      dvec←-⌿0 1⌽+\''{}''∘.=toks  ⍝ brace-depth of each token.       │⍞000D│      lmask←toks=''·''            ⍝ start of each line.              │⍞000D│      (dent×lmask/dvec)/¨'' ''    ⍝ indentation for each line.       │⍞000D│    }↑,/''·'',¨code               ⍝ collected code vector.           │⍞000D│    scoms←(⊂csep⍴'' ''),¨coms     ⍝ separated comments.              │⍞000D│    icode←↓↑dents,¨code         ⍝ indented code lines.             │⍞000D│    icode,¨scoms                ⍝ reunited code and comments.      │⍞000D│  }⎕NR ⍵                        ⍝ lines of function.               │⍞000D│}                                                                  │⍞000D└───────────────────────────────────────────────────────────────────┘⍞000D⍞000DSee also: wrapnote dots⍞000D⍞000DIndex:formatting, functions' 
