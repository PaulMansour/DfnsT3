'z ← l (fn ##.bags) r                        ⍝ Multisets/bags.⍞000D⍞000DOperator [bags] models the Parks-Smith proposal for a  $  operator,  which  adds⍞000DMultisets to APL.⍞000D⍞000DA "Multiset" or "bag" has attributes of both a vector and a set in that,  like a⍞000Dvector, it may have duplicate items and,  like a set,  the order of its items is⍞000Dnot significant.⍞000D⍞000D[bags] is an operator, which treats its arguments as if they were multisets.⍞000D⍞000D        1 2 2 3  ≡bags  2 1 3 2     ⍝ multiset item-order is not significant.⍞000D    1⍞000D        1 2 2 3  ≡bags  1 2 3 3     ⍝ multiset duplicate count is significant.⍞000D    0⍞000D⍞000DIllustration⍞000D------------⍞000DGiven two vectors, which we want to view as multisets:⍞000D⍞000D        A ← 2 1 2 1 3 2 5⍞000D        B ← 3 4 2 1 2 3⍞000D⍞000DBy permuting the vector items and indenting the second one,  we can arrange that⍞000Dall coincident items (if any) are aligned:⍞000D⍞000D                     ┌───────── ⍝ coincident items 1 2 2 3⍞000D                  ┌──┴──┐⍞000D        A ← 1 2 5 1 2 2 3       ⍝ permutation of 1st vector.⍞000D        B ←       1 2 2 3 4 3   ⍝       ..       2nd    ..⍞000D                  └─────┘⍞000D⍞000Dnow various multiset functions can be illustrated so:⍞000D⍞000D              ┌───────────────── A ~bags B  →  1 2 5    ⍝ asymmetric difference.⍞000D              │      ┌────────── A ∩bags B  →  1 2 2 3  ⍝ intersection.⍞000D            ┌─┴─┐ ┌──┴──┐  ┌──── B ~bags A  →  4 3      ⍝ asymmetric difference.⍞000D        A ← 1 2 5 1 2 2 3 ┌┴┐⍞000D        B ← │   │ 1 2 2 3 4 3⍞000D            └─┬─┘ └─────┘ └┬┘⍞000D            │ └────────────┴── A(''§''bags)B  →  1 2 5 4 3 ⍝ symmetric difference.⍞000D            └───────┬───────┘⍞000D                    └─────────── A ∪bags B  →  1 2 5 1 2 2 3 4 3    ⍝ union.⍞000D⍞000DSearching functions ⍳ and ∊ take account of duplicate items in multisets:⍞000D⍞000D        8 7 8 ⍳bags 8 8 8 8⍞000D    1 3 4 4⍞000D⍞000D        8 8 8 8 ∊bags 8 7 8⍞000D    1 1 0 0⍞000D⍞000DIn all, bags is defined for operands:⍞000D⍞000D    ≡    match.⍞000D    ≢    natch.⍞000D    ~    multiset asymmetric difference (MAD)⍞000D   ''§''   multiset symmetric difference (MSD) *⍞000D    ∪    unique/union.⍞000D    ∩    intersection.⍞000D    ∊    progressive membership.        Smith [2]⍞000D    ⍳    progressive dyadic iota.       FinnAPL Idiom List [3]⍞000D⍞000D[*] operand § must be enclosed in quotes, see example below.  Note also that the⍞000Dderived function (''§''bags) must be parenthesised in order to prevent operand ''§''⍞000Dfrom binding with the left argument: larg(''§''bags)rarg.  Alternatively, we might⍞000Dprefer to name ''§''bags:⍞000D⍞000D          1 2 3 (''§''bags) 2 3 4⍞000D    1 4⍞000D          msd ← ''§''bags⍞000D⍞000D          1 2 3 msd 2 3 4⍞000D    1 4⍞000D⍞000DTo allow for extending this operand set in the future, operands not in this list⍞000Dgenerate a NONCE ERROR.⍞000D⍞000DRefs:⍞000D    [0] Parks-Smith paper "Proposal for Multiset Features in APL"⍞000D    [1] http://en.wikipedia.org/wiki/Multiset⍞000D    [2] http://www.sudleyplace.com/APL/AnatomyOfAnIdiom.ahtml⍞000D    [3] http://nsg.upor.net/jpage/finnapl.pdf⍞000D⍞000DExamples:⍞000D⍞000D      1 2 3 1 2 3 ~bags 1 1 3 1         ⍝ multiset asymmetric difference (MAD)⍞000D2 2 3⍞000D⍞000D    1 1 1 2 2 3 (''§''bags) 1 2 2 3 3 3   ⍝ multiset symmetric difference (MSD)⍞000D1 1 3 3⍞000D⍞000D      1 2 3 1 2 3 ⍳bags 1 1 3 1         ⍝ progressive dyadic iota (PDI)⍞000D1 4 3 7⍞000D⍞000D    3 1 3 ∊bags 3 1 1 2                 ⍝ progressive dyadic epsilon (PDE)⍞000D1 1 0⍞000D⍞000D    (⊂1 2 2) ≡bags¨ (1 2)(2 2 1)(1 1 2) ⍝ match⍞000D0 1 0⍞000D⍞000D    (⊂1 2 2) ≢bags¨ (1 2)(2 2 1)(1 1 2) ⍝ natch⍞000D1 0 1⍞000D⍞000D    1 2 2 3 ∪bags 2 3 3                 ⍝ union⍞000D1 2 2 3 3⍞000D⍞000D    ∪bags 1 1 2 2                       ⍝ unique is a no-op⍞000D1 1 2 2⍞000D⍞000D    1 2 2 3 ∩bags 2 3 3 2               ⍝ intersection⍞000D2 2 3⍞000D⍞000D    1 2 3 3 1 2 3 ,bags 3 1 3           ⍝ non-multiset function⍞000D1 2 3 3 1 2 3 3 1 3⍞000D⍞000D    ''tick'' ''tock'' ≡bags ''tock'' ''tick''   ⍝ nested args.⍞000D1⍞000D    A←?10/5  ⋄  B←?10/5                 ⍝ vectors with repeated items.⍞000D⍞000D    (A ∪bags B) ≡bags (B ∪bags A)       ⍝ multiset-union is commutative.⍞000D1⍞000D    (A ∩bags B) ≡bags (B ∩bags A)       ⍝ multiset-intersection is commutative.⍞000D1⍞000D    msd←''§''bags ⋄ (A msd B) ≡bags (B msd A)     ⍝ MSD is commutative.⍞000D1⍞000D    (⍳⍴A) ≡ A ⍳bags A                   ⍝ progressive dyadic iota.⍞000D1⍞000D⍞000DIndex:multiset|bags|FinnAPL Idiom List⍞000DIndex;Parks P.|Smith R.A.' 
