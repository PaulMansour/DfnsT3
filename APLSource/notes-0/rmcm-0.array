'line ← ##.rmcm line                         ⍝ APL source with comments removed.⍞000D⍞000DRemoves  comments  from  a vector or matrix of APL, by identifying the first un-⍞000Dquoted "⍝" on each line character  and  stripping  it  and all characters to its⍞000Dright.⍞000D⍞000DNote that the function doesn''t  remove  any resulting trailing blank columns but⍞000Dif the result is to be passed to ⎕FX, this will make no difference.⍞000D⍞000DVMJ supplies this alternative, named after a Finnish  Prime Minister whose init-⍞000Dials  were  HHH, and whose most memorable quotation was "No comments, I''m drink-⍞000Ding coffee now".⍞000D⍞000D    hhh←{⍞000D        q←⍵⍞000D        ((∨\(⍵=''⍝'')∧=\⍵≠'''''''')/q)←'' ''⍞000D        (-+/∧\'' ''=⌽q)↓q⍞000D    }⍞000D⍞000DExamples:⍞000D⍞000D    rmcm ''a←b  ⍝ copy''                  ⍝ comment removed.⍞000Da←b⍞000D⍞000D    rmcm ''cm←''''⍝''''  ⍝ comment''          ⍝ ''⍝'' character preserved.⍞000Dcm←''⍝''⍞000D⍞000D    clean_fn←{⎕fx(rmcm¨⎕nr ⍵)~⊂''''}      ⍝ function with white space removed.⍞000D⍞000D    display ⎕cr''dup''                    ⍝ commented function.⍞000D┌→────────────────────────┐⍞000D↓dup←{                    │⍞000D│            ⍝ blah, blah,│⍞000D│                         │⍞000D│    ⍵ ⍵     ⍝ blah, blah,│⍞000D│                         │⍞000D│            ⍝ blah, blah.│⍞000D│                         │⍞000D│            ⍝ (c) C-A.S. │⍞000D│}                        │⍞000D└─────────────────────────┘⍞000D⍞000D    clean_fn''dup''                       ⍝ remove comments and blank lines.⍞000D⍞000D    display ⎕cr''dup''                    ⍝ uncommented function.⍞000D┌→──────┐⍞000D↓dup←{  │⍞000D│    ⍵ ⍵│⍞000D│}      │⍞000D└───────┘⍞000D⍞000D    one_liner←{⎕ML←0                    ⍝ Turn function into 1-liner.⍞000D        ⎕FX↑,↓{                         ⍝ fix:⍞000D            bd←''{⋄'' ''{''                 ⍝ brace-diamond → brace⍞000D            db←''⋄}'' ''}''                 ⍝ diamond-brace → brace⍞000D            bds←''{ ⋄'' ''{''               ⍝ brace diamond → brace⍞000D            dbs←''⋄ }'' ''}''               ⍝ diamond brace → brace⍞000D            ↑subs/bd db bds dbs ⍵       ⍝ substitution in⍞000D        }↑{⍺,''⋄'',⍵}/⎕NR ⍵               ⍝ diamond-joined lines.⍞000D    }⍞000D⍞000D    ⎕cr one_liner''dup''                  ⍝ turn dup into 1-liner.⍞000Ddup←{⍵ ⍵}⍞000D⍞000D    one_liner clean_fn''display''         ⍝ turn display fn into 1-liner.⍞000D⍞000D    ⎕cr''display''⍞000Ddisplay←{⎕IO ⎕ML←0 ⋄ ⍺←1 ⋄ chars←⍺⊃''..''''''''|-'' ''┌┐└┘│─'' ⋄ tl tr bl br vt hz←chars ⋄ box←{vrt hrz←(¯1+⍴⍵)⍴¨vt hz ⋄ top←(hz,''⊖→'')[¯1↑⍺],hrz ⋄ bot←(⊃⍺),hrz ⋄ rgt←tr,vt,vrt,br ⋄ lax←(vt,''⌽↓'')[¯1↓1↓⍺],¨⊂vrt ⋄ lft←⍉tl,(↑lax),bl ⋄ lft,(top⍪⍵⍪bot),rgt ⋄ } ⋄ deco←{⍺←type open ⍵ ⋄ ⍺,axes ⍵} ⋄ axes←{(-2⌈⍴⍴⍵)↑1+×⍴⍵} ⋄ open←{(1⌈⍴⍵)⍴⍵} ⋄ trim←{(~1 1⍷∧⌿⍵='' '')/⍵} ⋄ type←{{(1=⍴⍵)⊃''+''⍵}∪,char¨⍵} ⋄ char←{⍬≡⍴⍵:hz ⋄ (⊃⍵∊''¯'',⎕D)⊃''#~''}∘⍕ ⋄ {0=≡⍵:'' ''⍪(⎕FMT ⍵)⍪(⊃⍵ ⍵∊⎕AV)⊃'' -'' ⋄ 1 ⍬≡(≡⍵)(⍴⍵):''∇'' 0 0 box ⎕FMT ⍵ ⋄ 1=≡⍵:(deco ⍵)box open ⎕FMT open ⍵ ⋄ (''∊''deco ⍵)box trim ⎕FMT ∇¨open ⍵ ⋄ }⍵}⍞000D⍞000D    display ⍳2 2                        ⍝ still works!⍞000D┌→────────────┐⍞000D↓ ┌→──┐ ┌→──┐ │⍞000D│ │1 1│ │1 2│ │⍞000D│ └~──┘ └~──┘ │⍞000D│ ┌→──┐ ┌→──┐ │⍞000D│ │2 1│ │2 2│ │⍞000D│ └~──┘ └~──┘ │⍞000D└∊────────────┘⍞000D⍞000D    ⎕cr one_liner clean_fn ''one_liner''⍞000Done_liner←{⎕ML←0 ⋄ ⎕FX↑,↓{bd←''{'' ''{'' ⋄ db←''}'' ''}'' ⋄ bds←''{'' ''{'' ⋄ dbs←''}'' ''}'' ⋄ ↑subs/bd db bds dbs ⍵ ⋄ }↑{⍺,''⋄'',⍵}/⎕NR ⍵}⍞000D⍞000D⍝ This expression, with improvements from JoHo, removes comments from all⍞000D⍝ functions and operators in all namespaces:⍞000D⍞000D    rmcm(refs ⎕this).{⍺⍺{0=⍴⍵: ⋄ ⎕fx∘⍺⍺∘⎕cr¨⍵}⎕nl-,⍵∘.+0.1 0.2}⊂3 4⍞000D⍞000DSee also: tokens refs⍞000D⍞000DIndex:formatting, functions|comment removal|one-liner⍞000DIndex;Holkeri H.H.|Jantunen V-M.|Hoffmann J.' 
