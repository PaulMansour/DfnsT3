'cvecs ← {nv←0} ##.tokens cvec               ⍝ Lex of APL src line.⍞000D⍞000DSplits  an  APL  "source"  line  into  its constituent tokens. Character literal⍞000Dstrings, comments and expanses of "white space" are deemed single tokens.⍞000D⍞000DOptional  left  argument [nv] deterimines whether numeric vectors (1 2 3) are to⍞000Dbe considered:⍞000D⍞000D    0 multiple tokens (default)⍞000D    1 a single token⍞000D⍞000DAn alternative coding of the function might be:⍞000D⍞000D    tokens2←{⎕ML←0                              ⍝ Lex of APL source line.⍞000D        alph←(0≤⎕NC⍪⎕AV)/⎕AV                    ⍝ Alphabet for names.⍞000D        all←{+/∧\⍺∊⍵}                           ⍝ ∇ No of leading ⍺∊⍵⍞000D        acc←{n←⍺⍺ ⍵ ⋄ (⍺,⊂n↑⍵)lex n↓⍵}          ⍝ ∇∇ Accumulated tokens⍞000D        lex←{                                   ⍝ ∇ Next lexical token⍞000D            0=⍴⍵:⍺ ⋄ hd←⊃⍵                      ⍝ Next char else finished⍞000D            hd='' '':⍺{⍵ all'' ''}acc ⍵             ⍝ White Space⍞000D            hd∊alph:⍺{⍵ all alph,⎕D}acc ⍵       ⍝ Name⍞000D            hd∊''⎕:'':⍺{1+(1↓⍵)all alph,'':''}acc ⍵ ⍝ System Name / Keyword / guard⍞000D            hd='''''''':⍺{+/∧\{⍵∨¯1⌽⍵}≠\⍵=hd}acc ⍵  ⍝ Char literal⍞000D            hd∊⎕D,''¯'':⍺{⍵ all ⎕D,''.¯E''}acc ⍵    ⍝ Numeric scalar literal⍞000D            hd∊''⍺⍵∇'':⍺{⍵ all hd}acc ⍵           ⍝ Meta character.⍞000D            hd=''⍝'':⍺⍴acc ⍵                      ⍝ Comment⍞000D            ⍺{1}acc ⍵                           ⍝ Single char token⍞000D        }⍞000D        (0⍴⊂'''')lex,⍵⍞000D    }⍞000D⍞000DExample:⍞000D⍞000D      {⎕←1 disp tokens ⍵}¨⎕nr''tokens''⍞000D┌→─────┬─┬─┬───┬─┬─┬───────────────────────────┬──────────────────────┐⍞000D│tokens│←│{│⎕ML│←│3│                           │⍝ Lex of APL src line.│⍞000D└─────→┴→┴→┴──→┴→┴→┴──────────────────────────→┴─────────────────────→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───┬────┬─┬─┬─┬─┬───┬─┬───┬─┬─┬───┬────────────────┬─────────────────────┐⍞000D│    │alph│←│(│0│≤│⎕NC│⍪│⎕AV│)│/│⎕AV│                │⍝ Alphabet for names.│⍞000D└───→┴───→┴→┴→┴→┴→┴──→┴→┴──→┴→┴→┴──→┴───────────────→┴────────────────────→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───┬───┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬───────────────────────┬─────────────────────┐⍞000D│    │all│←│{│+│/│∧│\│⍺│∊│⍵│}│                       │⍝ No. of leading ⍺∊⍵.│⍞000D└───→┴──→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴──────────────────────→┴────────────────────→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───┬───┬─┬─┬─┬─┬─┬─┬─┬─┬─┬───┬─┬─┬─┬─┬─┬────────────────┬────────────────────┐⍞000D│    │acc│←│{│(│⍺│,│↑│/│⍵│)│lex│⊃│↓│/│⍵│}│                │⍝ Accumulate tokens.│⍞000D└───→┴──→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴──→┴→┴→┴→┴→┴→┴───────────────→┴───────────────────→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───┬───┬─┬─┐⍞000D│    │lex│←│{│⍞000D└───→┴──→┴→┴→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───────┬─┬─┬─┬─┬─┬─┬─┬─┬─┬──┬─┬─┬─┬──────────────────┬──────────────────────────┐⍞000D│        │0│=│⍴│⍵│:│⍺│ │⋄│ │hd│←│↑│⍵│                  │⍝ Next char else finished.│⍞000D└───────→┴→┴→┴→┴→┴→┴→┴→┴→┴→┴─→┴→┴→┴→┴─────────────────→┴─────────────────────────→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───────┬──┬─┬───┬─┬─┬─┬───────────────────────┬──────────────┐⍞000D│        │hd│=│'' ''│:│⍺│{│                       │⍝ White Space.│⍞000D└───────→┴─→┴→┴──→┴→┴→┴→┴──────────────────────→┴─────────────→┘⍞000D┌→───────────┬────┬─┬─┬─┬───┬───┐⍞000D│            │size│←│⍵│ │all│'' ''│⍞000D└───────────→┴───→┴→┴→┴→┴──→┴──→┘⍞000D┌→───────────┬─┬─┬───┬─┬────┬─┬─┐⍞000D│            │⍺│ │acc│ │size│ │⍵│⍞000D└───────────→┴→┴→┴──→┴→┴───→┴→┴→┘⍞000D┌→───────┬─┬─┐⍞000D│        │}│⍵│⍞000D└───────→┴→┴→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───────┬──┬─┬────┬─┬─┬─┬──────────────────────┬──────┐⍞000D│        │hd│∊│alph│:│⍺│{│                      │⍝ Name│⍞000D└───────→┴─→┴→┴───→┴→┴→┴→┴─────────────────────→┴─────→┘⍞000D┌→───────────┬────┬─┬─┬─┬───┬─┬────┬─┬──┐⍞000D│            │size│←│⍵│ │all│ │alph│,│⎕D│⍞000D└───────────→┴───→┴→┴→┴→┴──→┴→┴───→┴→┴─→┘⍞000D┌→───────────┬─┬─┬───┬─┬────┬─┬─┐⍞000D│            │⍺│ │acc│ │size│ │⍵│⍞000D└───────────→┴→┴→┴──→┴→┴───→┴→┴→┘⍞000D┌→───────┬─┬─┐⍞000D│        │}│⍵│⍞000D└───────→┴→┴→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───────┬──┬─┬────┬─┬─┬─┬──────────────────────┬───────────────────────┐⍞000D│        │hd│∊│''⎕:''│:│⍺│{│                      │⍝ System Name / Keyword│⍞000D└───────→┴─→┴→┴───→┴→┴→┴→┴─────────────────────→┴──────────────────────→┘⍞000D┌→───────────┬────┬─┬─┬─┬───┬─┬──┬─┬────┐⍞000D│            │size│←│⍵│ │all│ │hd│,│alph│⍞000D└───────────→┴───→┴→┴→┴→┴──→┴→┴─→┴→┴───→┘⍞000D┌→───────────┬─┬─┬───┬─┬────┬─┬─┐⍞000D│            │⍺│ │acc│ │size│ │⍵│⍞000D└───────────→┴→┴→┴──→┴→┴───→┴→┴→┘⍞000D┌→───────┬─┬─┐⍞000D│        │}│⍵│⍞000D└───────→┴→┴→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───────┬──┬─┬────┬─┬─┬─┬──────────────────────┬──────────────┐⍞000D│        │hd│=│''''''''│:│⍺│{│                      │⍝ Char literal│⍞000D└───────→┴─→┴→┴───→┴→┴→┴→┴─────────────────────→┴─────────────→┘⍞000D┌→───────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬──┬─┬─┬─┬─┬─┬──┬─┬─┐⍞000D│            │size│←│+│/│∧│\│{│⍵│∨│¯1│⌽│⍵│}│≠│\│hd│=│⍵│⍞000D└───────────→┴───→┴→┴→┴→┴→┴→┴→┴→┴→┴─→┴→┴→┴→┴→┴→┴─→┴→┴→┘⍞000D┌→───────────┬─┬─┬───┬─┬────┬─┬─┐⍞000D│            │⍺│ │acc│ │size│ │⍵│⍞000D└───────────→┴→┴→┴──→┴→┴───→┴→┴→┘⍞000D┌→───────┬─┬─┐⍞000D│        │}│⍵│⍞000D└───────→┴→┴→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───────┬──┬─┬──┬─┬───┬─┬─┬─┬────────────────────┬─────────────────┐⍞000D│        │hd│∊│⎕D│,│''¯''│:│⍺│{│                    │⍝ Numeric literal│⍞000D└───────→┴─→┴→┴─→┴→┴──→┴→┴→┴→┴───────────────────→┴────────────────→┘⍞000D┌→───────────┬────┬─┬─┬─┬───┬─┬──┬─┬─────┐⍞000D│            │size│←│⍵│ │all│ │⎕D│,│''.¯E''│⍞000D└───────────→┴───→┴→┴→┴→┴──→┴→┴─→┴→┴────→┘⍞000D┌→───────────┬─┬─┬───┬─┬────┬─┬─┐⍞000D│            │⍺│ │acc│ │size│ │⍵│⍞000D└───────────→┴→┴→┴──→┴→┴───→┴→┴→┘⍞000D┌→───────┬─┬─┐⍞000D│        │}│⍵│⍞000D└───────→┴→┴→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───────┬──┬─┬─────┬─┬─┬─┬─────────────────────┬────────────────┐⍞000D│        │hd│∊│''⍺⍵∇''│:│⍺│{│                     │⍝ ⍺⍺ or ⍵⍵ or ∇∇│⍞000D└───────→┴─→┴→┴────→┴→┴→┴→┴────────────────────→┴───────────────→┘⍞000D┌→───────────┬────┬─┬─┬─┬───┬─┬──┐⍞000D│            │size│←│⍵│ │all│ │hd│⍞000D└───────────→┴───→┴→┴→┴→┴──→┴→┴─→┘⍞000D┌→───────────┬─┬─┬───┬─┬────┬─┬─┐⍞000D│            │⍺│ │acc│ │size│ │⍵│⍞000D└───────────→┴→┴→┴──→┴→┴───→┴→┴→┘⍞000D┌→───────┬─┬─┐⍞000D│        │}│⍵│⍞000D└───────→┴→┴→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───────┬──┬─┬───┬─┬─┬─┬───┬─┬─┬─┬─┬─┬───────────────┬─────────┐⍞000D│        │hd│=│''⍝''│:│⍺│ │acc│(│⍴│⍵│)│⍵│               │⍝ Comment│⍞000D└───────→┴─→┴→┴──→┴→┴→┴→┴──→┴→┴→┴→┴→┴→┴──────────────→┴────────→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───────┬─┬─┬───┬─┬─┬─┬─┬───────────────────────┬────────────────────┐⍞000D│        │⍺│ │acc│ │1│ │⍵│                       │⍝ Single char token.│⍞000D└───────→┴→┴→┴──→┴→┴→┴→┴→┴──────────────────────→┴───────────────────→┘⍞000D┌→───┬─┐⍞000D│    │}│⍞000D└───→┴→┘⍞000D┌⊖┐⍞000D│ │⍞000D└⊖┘⍞000D┌→───┬─┬─┬─┬─┬──┬─┬───┬─┬─┐⍞000D│    │(│0│⍴│⊂│''''│)│lex│,│⍵│⍞000D└───→┴→┴→┴→┴→┴─→┴→┴──→┴→┴→┘⍞000D┌→┐⍞000D│}│⍞000D└→┘⍞000D⍞000DSee also: words unify rmcm segs⍞000D⍞000DIndex:parsing|lexical scan' 
